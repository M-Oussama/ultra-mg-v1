import{k as c,Z as J,o as b,b as j,w as s,p as e,q as i,D,bl as W,bm as X,E as y,m as l,c as A,F as $,a as F,x as _,V as ee,v as te,j as ae,y as B}from"./main.cd2f61e0.js";import{_ as le}from"./AppDateTimePicker.1fc75219.js";import{_ as se}from"./DialogCloseBtn.70b059be.js";import{_ as oe}from"./InvoiceProductEdit.c008bf00.js";/* empty css                        */import{u as de}from"./useSaleStore.606507aa.js";import{e as C}from"./errorsMiddleware.83771aa7.js";import{V as ie}from"./VDialog.c3e6213c.js";import{V as P,a as ne}from"./VBtn.e1e904d3.js";import{V as L,c as h}from"./VCard.9853818f.js";import{V as ce}from"./VTable.77f6bc90.js";import{V as x,a as r}from"./VRow.898a0674.js";import{V as ue}from"./VTextField.5c01b862.js";import{V as T}from"./VDivider.9ec6ad9d.js";import{V as R}from"./VAutocomplete.fb56f36b.js";import{V as N}from"./VSwitch.6be3606c.js";import{V as re}from"./VTextarea.f4a114de.js";import{s as me}from"./successMiddleware.4e9554ee.js";import{u as pe}from"./usereturnStore.dd7728a6.js";import{a as fe}from"./VOverlay.3efb3345.js";import{V as U}from"./VInput.d9b9f4da.js";import"./VField.f2498eb6.js";import"./index.a6631c22.js";import"./position.2424db25.js";import"./router.9dad819a.js";import"./easing.36b781ab.js";/* empty css                                                           */import"./scopeId.cdf98d50.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.a2433735.js";import"./VAvatar.4757eb8a.js";import"./VImg.93402943.js";/* empty css                   */import"./VCounter.4f9c66e0.js";import"./VSelect.31283854.js";import"./VList.628450c7.js";import"./VMenu.b7f96395.js";import"./VCheckboxBtn.bca6bfbd.js";import"./VSelectionControl.1ba6b55c.js";import"./VChip.aeed7fa3.js";import"./filter.0e000a26.js";import"./lazy.cd1f82ce.js";const _e=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase"}," Product "),l("th",{class:"text-uppercase"}," Date "),l("th",{class:"text-uppercase"}," Quantity "),l("th",{class:"text-uppercase"}," Price ")])],-1),ve={class:"ma-sm-4"},ye={class:"d-flex align-center mb-6"},be={class:"font-weight-bold text-xl"},Ve={class:"mb-0"},ge={class:"mb-0"},he={class:"mb-0"},xe={class:"mt-4 ma-sm-4"},we={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Se=l("span",{class:"me-3"},"Invoice",-1),Ie={class:"d-flex align-center justify-sm-end mb-3"},Ae=l("span",{class:"me-3"},"Date Issued",-1),Ce={class:"align-center mb-6"},De=l("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),Pe={class:"align-center mb-6"},ke=l("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Ee={class:"mt-4 ma-sm-4"},Te=l("span",{class:"text-sm-caption mb-5"},"Products",-1),Ne=l("div",{class:"mt-7 ma-sm-7"},null,-1),Re={class:"mx-sm-4 my-2"},Ue={class:"align-center mb-4"},je={class:"d-flex"},Le=l("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," PAID: ",-1),qe={class:"my-2 mx-sm-4 display-center"},$e=l("td",null,[l("div",{class:"me-5 text-start"},[l("p",{class:"mb-2 text-sm"}," Total Invoice ")])],-1),Fe={class:"font-weight-semibold"},Be={class:"mb-2 text-sm"},Oe=l("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),Ke={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(q){const a=q,k=de(),m=c(!1);let V=c(0);c({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),c([]),c([]);const v=c({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"});let d=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const w=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),S=n=>{f()},E=n=>{console.log(a.data.client.isEmpty),a.data.client.id!==void 0&&a.data.client.id>-1?k.getPriceHistory(n.id,a.data.client.id).then(t=>{I.value=t.data.products,console.log(I.value),m.value=!0,console.log(t)}).catch(t=>{console.log(t)}):C("Error"," You must select a client first")},I=c([]),u=n=>`${n.product.name}`;function f(){let n=a.data.sale_items.map(t=>t.price*t.quantity);V.value=n.reduce((t,p)=>t+p,0),a.data.total=n.reduce((t,p)=>t+p,0),a.data.total_amount=n.reduce((t,p)=>t+p,0),M()}const g=()=>{d.value!==void 0&&d.value.product!==void 0&&d.value.product.id!==-1&&(console.log(d.value.product.id),a.data.sale_items.findIndex(t=>t.product.id===d.value.product.id)===-1&&d.value.product.id!==-1&&a.data.sale_items.push({...d.value}),f())};J(d,()=>{});const O=n=>{const t=a.data.sale_items.findIndex(p=>p.product.id===n.product.id);console.log("index: "+t),a.data.sale_items.splice(t,1),f()},K=n=>{var t=Y(n);console.log(t),a.data.client={...t}},Y=n=>{for(let t=0;t<a.data.clients.length;t++)if(a.data.clients[t].id==n)return a.data.clients[t];return null},H=n=>{g(),d.value={...w.value}},M=()=>{a.data.payment?a.data.paymentAmount=V.value:a.data.paymentAmount=0},Z=n=>{a.data.client_id=null,k.getClientsPerCity(a.data.city).then(t=>{a.data.clients=t.data.clients}).catch(t=>{console.log(t)})},G=n=>{const t=a.data.products.find(p=>p.id===n);d.value={...t},H()};return(n,t)=>{const p=se,z=le;return b(),j(L,null,{default:s(()=>[e(ie,{modelValue:i(m),"onUpdate:modelValue":t[2]||(t[2]=o=>D(m)?m.value=o:null),persistent:"",class:"v-dialog-sm"},{activator:s(({props:o})=>[e(P,W(X(o)),{default:s(()=>[y(" Open Dialog ")]),_:2},1040)]),default:s(()=>[e(p,{onClick:t[0]||(t[0]=o=>m.value=!i(m))}),e(L,{title:"Price History "},{default:s(()=>[e(ce,{class:"text-no-wrap pt-5"},{default:s(()=>[_e,l("tbody",null,[(b(!0),A($,null,F(i(I),o=>(b(),A("tr",{key:o.id},[l("td",null,_(o.product.name),1),l("td",null,_(o.sale_date),1),l("td",null,_(o.quantity),1),l("td",null,_(o.price)+" DZD ",1)]))),128))])]),_:1}),e(h,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[e(P,{onClick:t[1]||(t[1]=o=>m.value=!1)},{default:s(()=>[y(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(x,null,{default:s(()=>[e(r,{cols:"12",md:"7"},{default:s(()=>[l("div",ve,[l("div",ye,[e(i(ee),{nodes:i(te).app.logo,class:"me-3"},null,8,["nodes"]),l("h6",be,_(i(v).name),1)]),l("p",Ve,_(i(v).address),1),l("p",ge,_(i(v).address2),1),l("p",he,_(i(v).phone1)+" , "+_(i(v).phone2),1)])]),_:1}),e(r,{cols:"12",md:"5"},{default:s(()=>[l("div",xe,[l("h6",we,[Se,l("span",null,[e(ue,{modelValue:a.data.id,"onUpdate:modelValue":t[3]||(t[3]=o=>a.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),l("p",Ie,[Ae,l("span",null,[e(z,{modelValue:a.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=o=>a.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),e(T),e(h,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(x,null,{default:s(()=>[e(r,{cols:"12",md:"12"},{default:s(()=>[e(x,null,{default:s(()=>[e(r,{cols:"12",md:"6"},{default:s(()=>[l("div",Ce,[De,e(R,{clearable:"",modelValue:a.data.city,"onUpdate:modelValue":[t[5]||(t[5]=o=>a.data.city=o),Z],items:a.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),e(r,{cols:"12",md:"6"},{default:s(()=>[l("div",Pe,[ke,e(R,{clearable:"",modelValue:a.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=o=>a.data.client_id=o),K],items:a.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T),e(h,{class:"add-products-form"},{default:s(()=>[l("div",Ee,[e(x,null,{default:s(()=>[e(r,{cols:"12",md:"12"},{default:s(()=>[Te,e(R,{class:"mt-4",clearable:"",modelValue:i(d),"onUpdate:modelValue":[t[7]||(t[7]=o=>D(d)?d.value=o:d=o),G],items:a.data.products,"item-value":"id","item-title":u,label:"Products"},null,8,["modelValue","items"])]),_:1}),e(r,{cols:"12",md:"2"})]),_:1})]),Ne,(b(!0),A($,null,F(a.data.sale_items,(o,Q)=>(b(),A("div",{key:Q,class:"ma-sm-4"},[e(oe,{id:o.id,data:o,onRemoveProduct:O,onTotalAmount:S,onPriceHistory:E},null,8,["id","data"])]))),128))]),_:1}),e(T),e(h,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[e(x,null,{default:s(()=>[e(r,{cols:"12",md:"5"},{default:s(()=>[l("div",Re,[l("div",Ue,[l("div",je,[Le,e(N,{modelValue:a.data.payment,"onUpdate:modelValue":t[8]||(t[8]=o=>a.data.payment=o),"true-value":1,"false-value":0},null,8,["modelValue"])])])])]),_:1}),e(r,{cols:"12",md:"3"}),e(r,{cols:"12",md:"4"},{default:s(()=>[l("div",qe,[l("table",null,[l("tr",null,[$e,l("td",Fe,[l("p",Be,_(i(V).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),e(T),e(h,{class:"mx-sm-4"},{default:s(()=>[Oe,e(re,{modelValue:a.data.note,"onUpdate:modelValue":t[9]||(t[9]=o=>a.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},Ye={id:"invoice-add"},He={class:"d-flex align-center justify-space-between"},Me={class:"d-flex align-center justify-space-between"},Ze={class:"d-flex align-center justify-space-between"},jt={__name:"index",setup(q){const a=c({id:1,balance:0,total_amount:0,sale_date:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate(),client_id:null,city:null,sale_status:{id:-1,name:""},amount_letter:"",notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},cities:[],sale_items:[],clients:[],products:[],sale_statues:[],payment:!1,paymentAmount:0}),k=ae(),m=c(!0),V=c(!1),v=c(!1);c([]);const d=c({isActive:!1}),w=c(null),S=c(!1),E=pe();d.isActive=!0,E.fetchData().then(u=>{console.log(u),a.value.id=u.data.last_id,a.value.clients=u.data.clients,a.value.cities=u.data.cities,a.value.products=u.data.products,a.value.sale_statues=u.data.sale_statues,d.isActive=!1}).catch(u=>{console.log(u),d.isActive=!1});const I=()=>{a.value.client.id===-1||a.value.sale_date===null||a.value.sale_items.length===0?(a.value.client.id===-1&&C("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),a.value.sale_date===null&&C("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),a.value.sale_items.length===0&&C("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):d.isActive||(d.isActive=!0,E.storeReturn(a.value).then(u=>{S.value=!0,w.value=u.data.id,me("Return Items created Successfully"),d.isActive=!1,k.push("/apps/pos/return/preview/"+w.value)}).catch(u=>{d.isActive=!1,console.log(u),C("Error",""),console.log(u)}))};return(u,f)=>(b(),A("div",Ye,[e(fe,{"model-value":i(d).isActive,class:"align-center justify-center"},{default:s(()=>[e(ne,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),e(x,null,{default:s(()=>[e(r,{cols:"12",md:"9"},{default:s(()=>[e(Ke,{data:i(a),loading:i(d)},null,8,["data","loading"])]),_:1}),e(r,{cols:"12",md:"3"},{default:s(()=>[e(L,{class:"mb-8"},{default:s(()=>[e(h,null,{default:s(()=>[e(P,{block:"","prepend-icon":"tabler-send",class:"mb-2"},{default:s(()=>[y(" Send Invoice ")]),_:1}),i(S)?(b(),j(P,{key:0,block:"",color:"default",variant:"tonal",class:"mb-2",to:{name:"apps-POS-sale-preview-id",params:{id:i(w)}}},{default:s(()=>[y(" Preview ")]),_:1},8,["to"])):B("",!0),i(S)?B("",!0):(b(),j(P,{key:1,loading:i(d).isActive,disabled:i(d).isActive,block:"",color:"success",onClick:I},{default:s(()=>[y(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),l("div",He,[e(U,{for:"payment-terms"},{default:s(()=>[y(" Payment Terms ")]),_:1}),l("div",null,[e(N,{id:"payment-terms",modelValue:i(m),"onUpdate:modelValue":f[0]||(f[0]=g=>D(m)?m.value=g:null)},null,8,["modelValue"])])]),l("div",Me,[e(U,{for:"client-notes"},{default:s(()=>[y(" Client Notes ")]),_:1}),l("div",null,[e(N,{id:"client-notes",modelValue:i(V),"onUpdate:modelValue":f[1]||(f[1]=g=>D(V)?V.value=g:null)},null,8,["modelValue"])])]),l("div",Ze,[e(U,{for:"payment-stub"},{default:s(()=>[y(" Payment Stub ")]),_:1}),l("div",null,[e(N,{id:"payment-stub",modelValue:i(v),"onUpdate:modelValue":f[2]||(f[2]=g=>D(v)?v.value=g:null)},null,8,["modelValue"])])])]),_:1})]),_:1})]))}};export{jt as default};
