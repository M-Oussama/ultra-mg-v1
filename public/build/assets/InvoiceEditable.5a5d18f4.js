import{_ as O}from"./AppDateTimePicker.1c1f8ec6.js";import{_ as G}from"./DialogCloseBtn.d96fa5aa.js";import{_ as M}from"./InvoiceProductEdit.d9fc5717.js";import{k as r,Z as I,o as _,b as Q,w as o,p as s,q as i,D as P,m as e,c as V,F as E,a as S,x as c,E as z,V as J,v as W,y as X}from"./main.77663dd9.js";/* empty css                        */import{e as tt}from"./errorsMiddleware.3f4965d3.js";import{u as et}from"./useSaleStore.bda14526.js";/* empty css                                                        */import{V as at}from"./VDialog.cd64e648.js";import{V as T,c as f}from"./VCard.c055d8a9.js";import{V as st}from"./VTable.50540da2.js";import{V as lt}from"./VBtn.bdd4e121.js";import{V as h,a as u}from"./VRow.fa18164f.js";import{V as k}from"./VTextField.4b80e92f.js";import{V as b}from"./VDivider.cb83f5dc.js";import{V as g}from"./VAutocomplete.f7e070ee.js";import{V as ot}from"./VSwitch.4fc3c2c7.js";import{V as dt}from"./VTextarea.893e1916.js";const nt=e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase"}," Product "),e("th",{class:"text-uppercase"}," Date "),e("th",{class:"text-uppercase"}," Quantity "),e("th",{class:"text-uppercase"}," Price ")])],-1),it={class:"ma-sm-4"},ct={class:"d-flex align-center mb-6"},mt={class:"font-weight-bold text-xl"},ut={class:"mb-0"},rt={class:"mb-0"},pt={class:"mb-0"},_t={class:"mt-4 ma-sm-4"},ft={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},xt=e("span",{class:"me-3"},"Invoice",-1),yt={class:"d-flex align-center justify-sm-end mb-3"},Vt=e("span",{class:"me-3"},"Date Issued",-1),ht={class:"align-center mb-6"},bt=e("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),vt={class:"align-center mb-6"},gt=e("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),wt={class:"mt-4 ma-sm-4"},Dt=e("span",{class:"text-sm-caption mb-5"},"Products",-1),Ct=e("div",{class:"mt-7 ma-sm-7"},null,-1),It={class:"mx-sm-4 my-2"},Pt={class:"align-center mb-4"},Et={class:"d-flex"},St=e("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payment : ",-1),Tt={key:0,class:"mx-sm-4 my-2"},kt={class:"align-center mb-4"},Ft=e("div",{class:"d-flex"},[e("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payments: ")],-1),Ut={class:"my-2 mx-sm-4 display-center"},At=e("td",null,[e("div",{class:"me-5 text-start"},[e("p",{class:"mb-2 text-sm"}," Total Invoice "),e("p",{class:"mb-2 text-sm"}," Payment Initial: "),e("p",{class:"mb-2 text-sm"}," Payments: "),e("p",{class:"mb-2 text-sm"}," Rest: ")])],-1),Nt={class:"font-weight-semibold"},Rt={class:"mb-2 text-sm"},qt={class:"mb-2 text-sm"},Lt={class:"mb-2 text-sm"},Bt={class:"mb-2 text-sm"},Zt=e("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),oe={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(F){const a=F;let x=r(0);r({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),r([]),r([]);const w=r([]),y=r({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"}),p=r(!1),D=et();let n=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const U=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),A=d=>{a.data.client_id=null,D.getClientsPerCity(a.data.client.city_id).then(t=>{a.data.clients=t.data.clients}).catch(t=>{console.log(t)})},N=d=>{v()},R=d=>`${d.product.name}`;function v(){let d=a.data.sale_items.map(t=>t.price*t.quantity);x.value=d.reduce((t,m)=>t+m,0),a.data.total=d.reduce((t,m)=>t+m,0),a.data.total_amount=d.reduce((t,m)=>t+m,0)}const q=()=>{n.value!==void 0&&n.value.product!==void 0&&n.value.product.id!==-1&&(console.log(n.value.product.id),a.data.sale_items.findIndex(t=>t.product.id===n.value.product.id)===-1&&n.value.product.id!==-1&&a.data.sale_items.push({...n.value}),v())};I(n,()=>{});const L=d=>{const t=a.data.sale_items.findIndex(m=>m.product.id===d.product.id);a.data.sale_items.splice(t,1),v()},B=d=>{q(),n.value={...U.value}},C=()=>{a.data.payment?a.data.regulation=x.value:a.data.regulation=0};I(a.data.payment,()=>{C()});const Z=d=>{var t=j(d);a.data.client={...t}},j=d=>{for(let t=0;t<a.data.clients.length;t++)if(a.data.clients[t].id==d)return a.data.clients[t];return null},H=d=>{a.data.client.id!==void 0&&a.data.client.id>-1?D.getPriceHistory(d.product_id,a.data.client.id).then(t=>{w.value=t.data.products,p.value=!0,console.log(t)}).catch(t=>{console.log(t)}):tt("Error"," You must select a client first")},K=d=>{const t=a.data.products.find(m=>m.id===d);n.value={...t},B()};return(d,t)=>{const m=G,Y=O;return _(),Q(T,null,{default:o(()=>[s(at,{modelValue:i(p),"onUpdate:modelValue":t[2]||(t[2]=l=>P(p)?p.value=l:null),persistent:"",class:"v-dialog-sm"},{default:o(()=>[s(m,{onClick:t[0]||(t[0]=l=>p.value=!i(p))}),s(T,{title:"Price History "},{default:o(()=>[s(st,{class:"text-no-wrap pt-5"},{default:o(()=>[nt,e("tbody",null,[(_(!0),V(E,null,S(i(w),l=>(_(),V("tr",{key:l.id},[e("td",null,c(l.product.name),1),e("td",null,c(l.sale_date),1),e("td",null,c(l.quantity),1),e("td",null,c(l.price)+" DZD ",1)]))),128))])]),_:1}),s(f,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[s(lt,{onClick:t[1]||(t[1]=l=>p.value=!1)},{default:o(()=>[z(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(f,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:o(()=>[s(h,null,{default:o(()=>[s(u,{cols:"12",md:"7"},{default:o(()=>[e("div",it,[e("div",ct,[s(i(J),{nodes:i(W).app.logo,class:"me-3"},null,8,["nodes"]),e("h6",mt,c(i(y).name),1)]),e("p",ut,c(i(y).address),1),e("p",rt,c(i(y).address2),1),e("p",pt,c(i(y).phone1)+" , "+c(i(y).phone2),1)])]),_:1}),s(u,{cols:"12",md:"5"},{default:o(()=>[e("div",_t,[e("h6",ft,[xt,e("span",null,[s(k,{modelValue:a.data.id,"onUpdate:modelValue":t[3]||(t[3]=l=>a.data.id=l),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),e("p",yt,[Vt,e("span",null,[s(Y,{modelValue:a.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=l=>a.data.sale_date=l),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),s(b),s(f,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:o(()=>[s(h,null,{default:o(()=>[s(u,{cols:"12",md:"12"},{default:o(()=>[s(h,null,{default:o(()=>[s(u,{cols:"12",md:"6"},{default:o(()=>[e("div",ht,[bt,s(g,{clearable:"",modelValue:a.data.client.city_id,"onUpdate:modelValue":[t[5]||(t[5]=l=>a.data.client.city_id=l),A],items:a.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),s(u,{cols:"12",md:"6"},{default:o(()=>[e("div",vt,[gt,s(g,{clearable:"",modelValue:a.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=l=>a.data.client_id=l),Z],items:a.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(b),s(f,{class:"add-products-form"},{default:o(()=>[e("div",wt,[s(h,null,{default:o(()=>[s(u,{cols:"12",md:"12"},{default:o(()=>[Dt,s(g,{class:"mt-4",clearable:"",modelValue:i(n),"onUpdate:modelValue":[t[7]||(t[7]=l=>P(n)?n.value=l:n=l),K],items:a.data.products,"item-value":"id","item-title":R,label:"Products"},null,8,["modelValue","items"])]),_:1}),s(u,{cols:"12",md:"2"})]),_:1})]),Ct,(_(!0),V(E,null,S(a.data.sale_items,(l,$)=>(_(),V("div",{key:$,class:"ma-sm-4"},[s(M,{id:l.id,data:l,onRemoveProduct:L,onTotalAmount:N,onPriceHistory:H},null,8,["id","data"])]))),128))]),_:1}),s(b),s(f,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:o(()=>[s(h,null,{default:o(()=>[s(u,{cols:"12",md:"3"},{default:o(()=>[e("div",It,[e("div",Pt,[e("div",Et,[St,s(ot,{modelValue:a.data.payment,"onUpdate:modelValue":t[8]||(t[8]=l=>a.data.payment=l),"true-value":!0,"false-value":!1,onChange:C},null,8,["modelValue"])])])])]),_:1}),s(u,{cols:"12",md:"5"},{default:o(()=>[a.data.payment?(_(),V("div",Tt,[e("div",kt,[Ft,s(k,{modelValue:a.data.regulation,"onUpdate:modelValue":t[9]||(t[9]=l=>a.data.regulation=l),type:"number"},null,8,["modelValue"])])])):X("",!0)]),_:1}),s(u,{cols:"12",md:"4"},{default:o(()=>[e("div",Ut,[e("table",null,[e("tr",null,[At,e("td",Nt,[e("p",Rt,c(i(x).toFixed(2))+" DZD ",1),e("p",qt,c(a.data.payment?parseFloat(a.data.regulation).toFixed(2):0)+" DZD ",1),e("p",Lt,c(a.data.paymentAmount?parseFloat(a.data.paymentAmount).toFixed(2):0)+" DZD ",1),e("p",Bt,c((a.data.payment?parseFloat(i(x))-parseFloat(a.data.paymentAmount):parseFloat(i(x))-parseFloat(a.data.paymentAmount)).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),s(b),s(f,{class:"mx-sm-4"},{default:o(()=>[Zt,s(dt,{modelValue:a.data.note,"onUpdate:modelValue":t[10]||(t[10]=l=>a.data.note=l),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}};export{oe as _};
