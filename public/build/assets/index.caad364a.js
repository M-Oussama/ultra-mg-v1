import{k as u,Z as ee,o as y,b as R,w as s,p as t,q as i,D as k,bm as te,bn as ae,E as V,m as l,c as S,F as B,a as O,x as r,V as le,v as se,y as L,j as oe,bf as K}from"./main.c6a9724c.js";import{_ as de}from"./AppDateTimePicker.effadfa0.js";import{_ as ie}from"./DialogCloseBtn.19a72d91.js";import{_ as ne}from"./InvoiceProductEdit.f30db29b.js";/* empty css                        */import{u as Z}from"./useSaleStore.2fbe7104.js";import{e as C}from"./errorsMiddleware.a5bff1e6.js";import{V as ue}from"./VDialog.6f70ea41.js";import{V as P,a as ce}from"./VBtn.e7c07512.js";import{V as q,c as g}from"./VCard.f64c0a01.js";import{V as me}from"./VTable.ee980c27.js";import{V as h,a as m}from"./VRow.ecaee667.js";import{V as Y}from"./VTextField.0d61a0d0.js";import{V as T}from"./VDivider.8e59889f.js";import{V as N}from"./VAutocomplete.02abd51f.js";import{V as U}from"./VSwitch.de57b8fe.js";import{V as re}from"./VTextarea.ae10c2b5.js";import{s as pe}from"./successMiddleware.c29016f5.js";import{a as fe}from"./VOverlay.01171e20.js";import{V as j}from"./VInput.ab935992.js";import"./VField.d7dc540f.js";import"./index.cb3fbeaa.js";import"./position.262cc80a.js";import"./router.8721ce32.js";import"./easing.36b781ab.js";/* empty css                                                           */import"./scopeId.b6fae753.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.29115eac.js";import"./VAvatar.6f1bab4f.js";import"./VImg.ed211343.js";/* empty css                   */import"./VCounter.92e789e6.js";import"./VSelect.f71ec185.js";import"./VList.d03d65eb.js";import"./VMenu.b523d10a.js";import"./VCheckboxBtn.a2176904.js";import"./VSelectionControl.3b08e1e2.js";import"./VChip.7e863aa4.js";import"./filter.db9c5770.js";import"./lazy.55ef32ef.js";const _e=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase"}," Product "),l("th",{class:"text-uppercase"}," Date "),l("th",{class:"text-uppercase"}," Quantity "),l("th",{class:"text-uppercase"}," Price ")])],-1),ve={class:"ma-sm-4"},ye={class:"d-flex align-center mb-6"},be={class:"font-weight-bold text-xl"},Ve={class:"mb-0"},xe={class:"mb-0"},ge={class:"mb-0"},he={class:"mt-4 ma-sm-4"},we={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Ae=l("span",{class:"me-3"},"Invoice",-1),De={class:"d-flex align-center justify-sm-end mb-3"},Se=l("span",{class:"me-3"},"Date Issued",-1),Ce={class:"align-center mb-6"},ke=l("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),Pe={class:"align-center mb-6"},Ie=l("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Ee={class:"mt-4 ma-sm-4"},Te=l("span",{class:"text-sm-caption mb-5"},"Products",-1),Ne=l("div",{class:"mt-7 ma-sm-7"},null,-1),Ue={class:"mx-sm-4 my-2"},Re={class:"align-center mb-4"},je={class:"d-flex"},Le=l("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payments: ",-1),qe={class:"my-2 mx-sm-4 display-center"},Fe=l("td",null,[l("div",{class:"me-5 text-start"},[l("p",{class:"mb-2 text-sm"}," Total Invoice "),l("p",{class:"mb-2 text-sm"}," Payment: "),l("p",{class:"mb-2 text-sm"}," Rest: ")])],-1),$e={class:"font-weight-semibold"},Be={class:"mb-2 text-sm"},Oe={class:"mb-2 text-sm"},Ke={class:"mb-2 text-sm"},Ye={class:"align-center mb-6"},Ze=l("h6",{class:"text-sm font-weight-medium mb-3"}," Driver: ",-1),He=l("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),Me={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(F){const e=F,I=Z(),p=u(!1);let b=u(0);u({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),u([]),u([]);const v=u({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"});let d=u({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const w=u({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),A=n=>{_()},E=n=>{console.log(e.data.client.isEmpty),e.data.client.id!==void 0&&e.data.client.id>-1?I.getPriceHistory(n.id,e.data.client.id).then(a=>{D.value=a.data.products,console.log(D.value),p.value=!0,console.log(a)}).catch(a=>{console.log(a)}):C("Error"," You must select a client first")},D=u([]),c=n=>`${n.product.name}`;function _(){let n=e.data.sale_items.map(a=>a.price*a.quantity);b.value=n.reduce((a,f)=>a+f,0),e.data.total=n.reduce((a,f)=>a+f,0),e.data.total_amount=n.reduce((a,f)=>a+f,0),$()}const x=()=>{d.value!==void 0&&d.value.product!==void 0&&d.value.product.id!==-1&&(console.log(d.value.product.id),e.data.sale_items.findIndex(a=>a.product.id===d.value.product.id)===-1&&d.value.product.id!==-1&&e.data.sale_items.push({...d.value}),_())};ee(d,()=>{});const H=n=>{const a=e.data.sale_items.findIndex(f=>f.product.id===n.product.id);console.log("index: "+a),e.data.sale_items.splice(a,1),_()},M=n=>{var a=G(n);e.data.client={...a}},G=n=>{for(let a=0;a<e.data.clients.length;a++)if(e.data.clients[a].id==n)return e.data.clients[a];return null},z=n=>{x(),d.value={...w.value}},$=()=>{e.data.payment?e.data.paymentAmount=b.value:e.data.paymentAmount=0},Q=n=>{e.data.client_id=null,I.getClientsPerCity(e.data.city).then(a=>{e.data.clients=a.data.clients}).catch(a=>{console.log(a)})},J=n=>{const a=e.data.products.find(f=>f.id===n);d.value={...a},z()};return(n,a)=>{const f=ie,W=de;return y(),R(q,null,{default:s(()=>[t(ue,{modelValue:i(p),"onUpdate:modelValue":a[2]||(a[2]=o=>k(p)?p.value=o:null),persistent:"",class:"v-dialog-sm"},{activator:s(({props:o})=>[t(P,te(ae(o)),{default:s(()=>[V(" Open Dialog ")]),_:2},1040)]),default:s(()=>[t(f,{onClick:a[0]||(a[0]=o=>p.value=!i(p))}),t(q,{title:"Price History "},{default:s(()=>[t(me,{class:"text-no-wrap pt-5"},{default:s(()=>[_e,l("tbody",null,[(y(!0),S(B,null,O(i(D),o=>(y(),S("tr",{key:o.id},[l("td",null,r(o.product.name),1),l("td",null,r(o.sale_date),1),l("td",null,r(o.quantity),1),l("td",null,r(o.price)+" DZD ",1)]))),128))])]),_:1}),t(g,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[t(P,{onClick:a[1]||(a[1]=o=>p.value=!1)},{default:s(()=>[V(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[t(h,null,{default:s(()=>[t(m,{cols:"12",md:"7"},{default:s(()=>[l("div",ve,[l("div",ye,[t(i(le),{nodes:i(se).app.logo,class:"me-3"},null,8,["nodes"]),l("h6",be,r(i(v).name),1)]),l("p",Ve,r(i(v).address),1),l("p",xe,r(i(v).address2),1),l("p",ge,r(i(v).phone1)+" , "+r(i(v).phone2),1)])]),_:1}),t(m,{cols:"12",md:"5"},{default:s(()=>[l("div",he,[l("h6",we,[Ae,l("span",null,[t(Y,{modelValue:e.data.id,"onUpdate:modelValue":a[3]||(a[3]=o=>e.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),l("p",De,[Se,l("span",null,[t(W,{modelValue:e.data.sale_date,"onUpdate:modelValue":a[4]||(a[4]=o=>e.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),t(T),t(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[t(h,null,{default:s(()=>[t(m,{cols:"12",md:"12"},{default:s(()=>[t(h,null,{default:s(()=>[t(m,{cols:"12",md:"6"},{default:s(()=>[l("div",Ce,[ke,t(N,{clearable:"",modelValue:e.data.city,"onUpdate:modelValue":[a[5]||(a[5]=o=>e.data.city=o),Q],items:e.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),t(m,{cols:"12",md:"6"},{default:s(()=>[l("div",Pe,[Ie,t(N,{clearable:"",modelValue:e.data.client_id,"onUpdate:modelValue":[a[6]||(a[6]=o=>e.data.client_id=o),M],items:e.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(T),t(g,{class:"add-products-form"},{default:s(()=>[l("div",Ee,[t(h,null,{default:s(()=>[t(m,{cols:"12",md:"12"},{default:s(()=>[Te,t(N,{class:"mt-4",clearable:"",modelValue:i(d),"onUpdate:modelValue":[a[7]||(a[7]=o=>k(d)?d.value=o:d=o),J],items:e.data.products,"item-value":"id","item-title":c,label:"Products"},null,8,["modelValue","items"])]),_:1}),t(m,{cols:"12",md:"2"})]),_:1})]),Ne,(y(!0),S(B,null,O(e.data.sale_items,(o,X)=>(y(),S("div",{key:X,class:"ma-sm-4"},[t(ne,{id:o.id,data:o,onRemoveProduct:H,onTotalAmount:A,onPriceHistory:E},null,8,["id","data"])]))),128))]),_:1}),t(T),t(g,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[t(h,null,{default:s(()=>[t(m,{cols:"12",md:"5"},{default:s(()=>[l("div",Ue,[l("div",Re,[l("div",je,[Le,t(U,{modelValue:e.data.payment,"onUpdate:modelValue":a[8]||(a[8]=o=>e.data.payment=o),"true-value":1,"false-value":0,onChange:$},null,8,["modelValue"])]),e.data.payment?(y(),R(Y,{key:0,modelValue:e.data.paymentAmount,"onUpdate:modelValue":a[9]||(a[9]=o=>e.data.paymentAmount=o),type:"number"},null,8,["modelValue"])):L("",!0)])])]),_:1}),t(m,{cols:"12",md:"3"}),t(m,{cols:"12",md:"4"},{default:s(()=>[l("div",qe,[l("table",null,[l("tr",null,[Fe,l("td",$e,[l("p",Be,r(i(b).toFixed(2))+" DZD ",1),l("p",Oe,r(e.data.paymentAmount?e.data.paymentAmount:0)+" DZD ",1),l("p",Ke,r(((e.data.paymentAmount?e.data.paymentAmount:0)-i(b)).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),t(T),t(m,{cols:"12",md:"12"},{default:s(()=>[l("div",Ye,[Ze,t(N,{clearable:"",modelValue:e.data.driver_id,"onUpdate:modelValue":a[10]||(a[10]=o=>e.data.driver_id=o),items:e.data.drivers,"item-value":"id","item-title":"full_name",label:"Driver"},null,8,["modelValue","items"])])]),_:1}),t(g,{class:"mx-sm-4"},{default:s(()=>[He,t(re,{modelValue:e.data.note,"onUpdate:modelValue":a[11]||(a[11]=o=>e.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},Ge={id:"invoice-add"},ze={class:"d-flex align-center justify-space-between"},Qe={class:"d-flex align-center justify-space-between"},Je={class:"d-flex align-center justify-space-between"},We={__name:"index",setup(F){const e=u({id:1,balance:0,total_amount:0,sale_date:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate(),client_id:null,city:null,sale_status:{id:-1,name:""},amount_letter:"",driver_id:null,notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},cities:[],sale_items:[],clients:[],drivers:[],products:[],sale_statues:[],payment:!1,paymentAmount:0}),I=oe(),p=u(!0),b=u(!1),v=u(!1);u([]);const d=u({isActive:!1}),w=u(null),A=u(!1),E=Z();d.isActive=!0,E.fetchData().then(c=>{e.value.id=c.data.last_id,e.value.clients=c.data.clients,e.value.drivers=c.data.drivers,e.value.cities=c.data.cities,e.value.products=c.data.products,e.value.sale_statues=c.data.sale_statues,d.isActive=!1,console.log(d.isActive)}).catch(c=>{console.log(c),d.isActive=!1});const D=()=>{e.value.client.id===-1||e.value.sale_date===null||e.value.sale_items.length===0?(e.value.client.id===-1&&C("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),e.value.sale_date===null&&C("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),e.value.sale_items.length===0&&C("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):d.isActive||(d.isActive=!0,E.storeSale(e.value).then(c=>{A.value=!0,w.value=c.data.id,pe("Sale created Successfully"),d.isActive=!1,I.push("/apps/pos/sale/preview/"+w.value)}).catch(c=>{d.isActive=!1,console.log(c),C("Error",""),console.log(c)}))};return(c,_)=>(y(),S("div",Ge,[t(fe,{"model-value":i(d).isActive,class:"align-center justify-center"},{default:s(()=>[t(ce,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),t(h,null,{default:s(()=>[t(m,{cols:"12",md:"9"},{default:s(()=>[t(Me,{data:i(e),loading:i(d)},null,8,["data","loading"])]),_:1}),t(m,{cols:"12",md:"3"},{default:s(()=>[t(q,{class:"mb-8"},{default:s(()=>[t(g,null,{default:s(()=>[t(P,{block:"","prepend-icon":"tabler-send",class:"mb-2"},{default:s(()=>[V(" Send Invoice ")]),_:1}),i(A)?(y(),R(P,{key:0,block:"",color:"default",variant:"tonal",class:"mb-2",to:{name:"apps-POS-sale-preview-id",params:{id:i(w)}}},{default:s(()=>[V(" Preview ")]),_:1},8,["to"])):L("",!0),i(A)?L("",!0):(y(),R(P,{key:1,loading:i(d).isActive,disabled:i(d).isActive,block:"",color:"success",onClick:D},{default:s(()=>[V(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),l("div",ze,[t(j,{for:"payment-terms"},{default:s(()=>[V(" Payment Terms ")]),_:1}),l("div",null,[t(U,{id:"payment-terms",modelValue:i(p),"onUpdate:modelValue":_[0]||(_[0]=x=>k(p)?p.value=x:null)},null,8,["modelValue"])])]),l("div",Qe,[t(j,{for:"client-notes"},{default:s(()=>[V(" Client Notes ")]),_:1}),l("div",null,[t(U,{id:"client-notes",modelValue:i(b),"onUpdate:modelValue":_[1]||(_[1]=x=>k(b)?b.value=x:null)},null,8,["modelValue"])])]),l("div",Je,[t(j,{for:"payment-stub"},{default:s(()=>[V(" Payment Stub ")]),_:1}),l("div",null,[t(U,{id:"payment-stub",modelValue:i(v),"onUpdate:modelValue":_[2]||(_[2]=x=>k(v)?v.value=x:null)},null,8,["modelValue"])])])]),_:1})]),_:1})]))}};typeof K=="function"&&K(We);export{We as default};
