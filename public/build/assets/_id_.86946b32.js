import{k as r,Z as K,o as b,b as F,w as s,p as t,q as d,D as k,m as e,c as T,F as Z,a as H,x as p,E as h,V as te,v as ae,y as L,bd as le,j as se,bf as M}from"./main.c6a9724c.js";import{_ as oe}from"./AppDateTimePicker.effadfa0.js";import{u as G}from"./useSaleStore.2fbe7104.js";import{e as E}from"./errorsMiddleware.a5bff1e6.js";import{s as de}from"./successMiddleware.c29016f5.js";import{_ as ie}from"./InvoiceSendInvoiceDrawer.507dd949.js";import{_ as ne}from"./DialogCloseBtn.19a72d91.js";import{_ as me}from"./InvoiceProductEdit.f30db29b.js";/* empty css                        *//* empty css                                                        */import{V as ue}from"./VDialog.6f70ea41.js";import{V as q,c as g}from"./VCard.f64c0a01.js";import{V as re}from"./VTable.ee980c27.js";import{V as R,a as ce}from"./VBtn.e7c07512.js";import{V as S,a as f}from"./VRow.ecaee667.js";import{V as Y}from"./VTextField.0d61a0d0.js";import{V as N}from"./VDivider.8e59889f.js";import{V as U}from"./VAutocomplete.02abd51f.js";import{V as $}from"./VSwitch.de57b8fe.js";import{V as pe}from"./VTextarea.ae10c2b5.js";import{a as fe}from"./VOverlay.01171e20.js";import{V as j}from"./VInput.ab935992.js";import"./VField.d7dc540f.js";import"./index.cb3fbeaa.js";import"./position.262cc80a.js";import"./router.8721ce32.js";import"./easing.36b781ab.js";import"./VSpacer.e083bbdb.js";import"./VAvatar.6f1bab4f.js";import"./VImg.ed211343.js";import"./VForm.821cf149.js";import"./forwardRefs.c003b6b8.js";import"./VChip.7e863aa4.js";import"./VNavigationDrawer.ef81bf50.js";import"./ssrBoot.6ecdcdd2.js";/* empty css                                                           */import"./scopeId.b6fae753.js";import"./dialog-transition.29115eac.js";/* empty css                   */import"./VCounter.92e789e6.js";import"./VSelect.f71ec185.js";import"./VList.d03d65eb.js";import"./VMenu.b523d10a.js";import"./VCheckboxBtn.a2176904.js";import"./VSelectionControl.3b08e1e2.js";import"./filter.db9c5770.js";import"./lazy.55ef32ef.js";const _e=e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase"}," Product "),e("th",{class:"text-uppercase"}," Date "),e("th",{class:"text-uppercase"}," Quantity "),e("th",{class:"text-uppercase"}," Price ")])],-1),ve={class:"ma-sm-4"},ye={class:"d-flex align-center mb-6"},be={class:"font-weight-bold text-xl"},xe={class:"mb-0"},Ve={class:"mb-0"},he={class:"mb-0"},ge={class:"mt-4 ma-sm-4"},we={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Se=e("span",{class:"me-3"},"Invoice",-1),ke={class:"d-flex align-center justify-sm-end mb-3"},De=e("span",{class:"me-3"},"Date Issued",-1),Pe={class:"align-center mb-6"},Ae=e("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),Ce={class:"align-center mb-6"},Ie=e("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Te={class:"mt-4 ma-sm-4"},Ee=e("span",{class:"text-sm-caption mb-5"},"Products",-1),Ne=e("div",{class:"mt-7 ma-sm-7"},null,-1),Ue={class:"mx-sm-4 my-2"},Fe={class:"align-center mb-4"},Re={class:"d-flex"},$e=e("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payment : ",-1),je={key:0,class:"mx-sm-4 my-2"},Le={class:"align-center mb-4"},qe=e("div",{class:"d-flex"},[e("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payments: ")],-1),Oe={class:"my-2 mx-sm-4 display-center"},Be=e("td",null,[e("div",{class:"me-5 text-start"},[e("p",{class:"mb-2 text-sm"}," Total Invoice "),e("p",{class:"mb-2 text-sm"}," Payment Initial: "),e("p",{class:"mb-2 text-sm"}," Payments: "),e("p",{class:"mb-2 text-sm"}," Rest: ")])],-1),Ke={class:"font-weight-semibold"},Ze={class:"mb-2 text-sm"},He={class:"mb-2 text-sm"},Me={class:"mb-2 text-sm"},Ye={class:"mb-2 text-sm"},Ge={class:"align-center mb-6"},ze=e("h6",{class:"text-sm font-weight-medium mb-3"}," Driver: ",-1),Qe=e("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),Je={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(O){const l=O;let V=r(0);r({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),r([]),r([]);const m=r([]),x=r({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"}),u=r(!1),w=G();let n=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const D=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),P=i=>{l.data.client_id=null,w.getClientsPerCity(l.data.client.city_id).then(a=>{l.data.clients=a.data.clients}).catch(a=>{console.log(a)})},A=i=>{I()},C=i=>`${i.product.name}`;function I(){let i=l.data.sale_items.map(a=>a.price*a.quantity);V.value=i.reduce((a,v)=>a+v,0),l.data.total=i.reduce((a,v)=>a+v,0),l.data.total_amount=i.reduce((a,v)=>a+v,0)}const c=()=>{n.value!==void 0&&n.value.product!==void 0&&n.value.product.id!==-1&&(console.log(n.value.product.id),l.data.sale_items.findIndex(a=>a.product.id===n.value.product.id)===-1&&n.value.product.id!==-1&&l.data.sale_items.push({...n.value}),I())};K(n,()=>{});const _=i=>{const a=l.data.sale_items.findIndex(v=>v.product.id===i.product.id);l.data.sale_items.splice(a,1),I()},y=i=>{c(),n.value={...D.value}},B=()=>{l.data.payment?l.data.regulation=V.value:l.data.regulation=0};K(l.data.payment,()=>{B()});const z=i=>{var a=Q(i);l.data.client={...a}},Q=i=>{for(let a=0;a<l.data.clients.length;a++)if(l.data.clients[a].id==i)return l.data.clients[a];return null},J=i=>{l.data.client.id!==void 0&&l.data.client.id>-1?w.getPriceHistory(i.product_id,l.data.client.id).then(a=>{m.value=a.data.products,u.value=!0,console.log(a)}).catch(a=>{console.log(a)}):E("Error"," You must select a client first")},W=i=>{const a=l.data.products.find(v=>v.id===i);n.value={...a},y()};return(i,a)=>{const v=ne,X=oe;return b(),F(q,null,{default:s(()=>[t(ue,{modelValue:d(u),"onUpdate:modelValue":a[2]||(a[2]=o=>k(u)?u.value=o:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[t(v,{onClick:a[0]||(a[0]=o=>u.value=!d(u))}),t(q,{title:"Price History "},{default:s(()=>[t(re,{class:"text-no-wrap pt-5"},{default:s(()=>[_e,e("tbody",null,[(b(!0),T(Z,null,H(d(m),o=>(b(),T("tr",{key:o.id},[e("td",null,p(o.product.name),1),e("td",null,p(o.sale_date),1),e("td",null,p(o.quantity),1),e("td",null,p(o.price)+" DZD ",1)]))),128))])]),_:1}),t(g,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[t(R,{onClick:a[1]||(a[1]=o=>u.value=!1)},{default:s(()=>[h(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[t(S,null,{default:s(()=>[t(f,{cols:"12",md:"7"},{default:s(()=>[e("div",ve,[e("div",ye,[t(d(te),{nodes:d(ae).app.logo,class:"me-3"},null,8,["nodes"]),e("h6",be,p(d(x).name),1)]),e("p",xe,p(d(x).address),1),e("p",Ve,p(d(x).address2),1),e("p",he,p(d(x).phone1)+" , "+p(d(x).phone2),1)])]),_:1}),t(f,{cols:"12",md:"5"},{default:s(()=>[e("div",ge,[e("h6",we,[Se,e("span",null,[t(Y,{modelValue:l.data.id,"onUpdate:modelValue":a[3]||(a[3]=o=>l.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),e("p",ke,[De,e("span",null,[t(X,{modelValue:l.data.sale_date,"onUpdate:modelValue":a[4]||(a[4]=o=>l.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),t(N),t(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[t(S,null,{default:s(()=>[t(f,{cols:"12",md:"12"},{default:s(()=>[t(S,null,{default:s(()=>[t(f,{cols:"12",md:"6"},{default:s(()=>[e("div",Pe,[Ae,t(U,{clearable:"",modelValue:l.data.client.city_id,"onUpdate:modelValue":[a[5]||(a[5]=o=>l.data.client.city_id=o),P],items:l.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),t(f,{cols:"12",md:"6"},{default:s(()=>[e("div",Ce,[Ie,t(U,{clearable:"",modelValue:l.data.client_id,"onUpdate:modelValue":[a[6]||(a[6]=o=>l.data.client_id=o),z],items:l.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(N),t(g,{class:"add-products-form"},{default:s(()=>[e("div",Te,[t(S,null,{default:s(()=>[t(f,{cols:"12",md:"12"},{default:s(()=>[Ee,t(U,{class:"mt-4",clearable:"",modelValue:d(n),"onUpdate:modelValue":[a[7]||(a[7]=o=>k(n)?n.value=o:n=o),W],items:l.data.products,"item-value":"id","item-title":C,label:"Products"},null,8,["modelValue","items"])]),_:1}),t(f,{cols:"12",md:"2"})]),_:1})]),Ne,(b(!0),T(Z,null,H(l.data.sale_items,(o,ee)=>(b(),T("div",{key:ee,class:"ma-sm-4"},[t(me,{id:o.id,data:o,onRemoveProduct:_,onTotalAmount:A,onPriceHistory:J},null,8,["id","data"])]))),128))]),_:1}),t(N),t(g,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[t(S,null,{default:s(()=>[t(f,{cols:"12",md:"3"},{default:s(()=>[e("div",Ue,[e("div",Fe,[e("div",Re,[$e,t($,{modelValue:l.data.payment,"onUpdate:modelValue":a[8]||(a[8]=o=>l.data.payment=o),"true-value":!0,"false-value":!1,onChange:B},null,8,["modelValue"])])])])]),_:1}),t(f,{cols:"12",md:"5"},{default:s(()=>[l.data.payment?(b(),T("div",je,[e("div",Le,[qe,t(Y,{modelValue:l.data.regulation,"onUpdate:modelValue":a[9]||(a[9]=o=>l.data.regulation=o),type:"number"},null,8,["modelValue"])])])):L("",!0)]),_:1}),t(f,{cols:"12",md:"4"},{default:s(()=>[e("div",Oe,[e("table",null,[e("tr",null,[Be,e("td",Ke,[e("p",Ze,p(d(V).toFixed(2))+" DZD ",1),e("p",He,p(l.data.payment?parseFloat(l.data.regulation).toFixed(2):0)+" DZD ",1),e("p",Me,p(l.data.paymentAmount?parseFloat(l.data.paymentAmount).toFixed(2):0)+" DZD ",1),e("p",Ye,p((l.data.payment?parseFloat(d(V))-parseFloat(l.data.paymentAmount):parseFloat(d(V))-parseFloat(l.data.paymentAmount)).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),t(N),t(f,{cols:"12",md:"12"},{default:s(()=>[e("div",Ge,[ze,t(U,{clearable:"",modelValue:l.data.truck_driver_id,"onUpdate:modelValue":a[10]||(a[10]=o=>l.data.truck_driver_id=o),items:l.data.drivers,"item-value":"id","item-title":"full_name",label:"Driver"},null,8,["modelValue","items"])])]),_:1}),t(g,{class:"mx-sm-4"},{default:s(()=>[Qe,t(pe,{modelValue:l.data.note,"onUpdate:modelValue":a[11]||(a[11]=o=>l.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},We=e("h6",{class:"text-sm font-weight-medium mb-3"}," Payment Method: ",-1),Xe={class:"mt-5 d-flex align-center justify-space-between"},et={class:"d-flex align-center justify-space-between"},tt={class:"d-flex align-center justify-space-between"},at={__name:"[id]",setup(O){const l=le(),V=se(),m=r({id:1,balance:0,total_amount:0,sale_date:null,client_id:1,city:null,truck_driver_id:null,cities:[],sale_status:{id:-1,name:""},amount_letter:"",notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},sale_items:[],clients:[],drivers:[],products:[],sale_statues:[],payment:!0,paymentAmount:0,payment_total:0,totalPayment:0,removePaymentRecords:!1}),x=G(),u=r({isActive:!1}),w=r(null);x.getSaleData(Number(l.params.id)).then(c=>{u.isActive=!1,m.value=c.data.sale,m.value.clients=c.data.clients,m.value.drivers=c.data.drivers,m.value.cities=c.data.cities,m.value.products=c.data.products,m.value.sale_statues=c.data.sale_statues,m.paymentAmount=c.data.sale.payment_total}).catch(c=>{u.isActive=!1,console.log(c)});const n=r(!1);r(!1);const D=r(!0),P=r(!1),A=r(!1),C=r(!1),I=()=>{m.value.client.id===-1||m.value.sale_date===null||m.value.sale_items.length===0?(m.value.client.id===-1&&E("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),m.value.sale_date===null&&E("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),m.value.sale_items.length===0&&E("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):u.isActive||(u.isActive=!0,x.updateSale(m.value).then(c=>{u.isActive=!1,C.value=!0,w.value=c.data.id,de("Sale created Successfully"),V.push("/apps/pos/sale/preview/"+w.value)}).catch(c=>{u.isActive=!1,console.log(c),E("Error",""),console.log(c)}))};return(c,_)=>(b(),F(S,null,{default:s(()=>[t(fe,{"model-value":d(u).isActive,class:"align-center justify-center"},{default:s(()=>[t(ce,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),t(f,{cols:"12",md:"9"},{default:s(()=>[t(Je,{data:d(m),loading:d(u)},null,8,["data","loading"])]),_:1}),t(f,{cols:"12",md:"3"},{default:s(()=>[t(q,{class:"mb-8"},{default:s(()=>[t(g,null,{default:s(()=>[t(R,{block:"","prepend-icon":"tabler-send",class:"mb-2",onClick:_[0]||(_[0]=y=>n.value=!0)},{default:s(()=>[h(" Send Invoice ")]),_:1}),d(C)?(b(),F(R,{key:0,block:"",color:"secondary",variant:"tonal",class:"mb-2",to:{name:"apps-POS-sale-preview-id",params:{id:d(w)}}},{default:s(()=>[h(" Preview ")]),_:1},8,["to"])):L("",!0),d(C)?L("",!0):(b(),F(R,{key:1,loading:d(u).isActive,disabled:d(u).isActive,block:"",color:"success",class:"mb-2",onClick:I},{default:s(()=>[h(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),We,e("div",Xe,[t(j,{for:"payment-terms"},{default:s(()=>[h(" Payment Terms ")]),_:1}),e("div",null,[t($,{id:"payment-terms",modelValue:d(D),"onUpdate:modelValue":_[1]||(_[1]=y=>k(D)?D.value=y:null)},null,8,["modelValue"])])]),e("div",et,[t(j,{for:"client-notes"},{default:s(()=>[h(" Client Notes ")]),_:1}),e("div",null,[t($,{id:"client-notes",modelValue:d(P),"onUpdate:modelValue":_[2]||(_[2]=y=>k(P)?P.value=y:null)},null,8,["modelValue"])])]),e("div",tt,[t(j,{for:"payment-stub"},{default:s(()=>[h(" Payment Stub ")]),_:1}),e("div",null,[t($,{id:"payment-stub",modelValue:d(A),"onUpdate:modelValue":_[3]||(_[3]=y=>k(A)?A.value=y:null)},null,8,["modelValue"])])])]),_:1}),t(ie,{isDrawerOpen:d(n),"onUpdate:isDrawerOpen":_[4]||(_[4]=y=>k(n)?n.value=y:null)},null,8,["isDrawerOpen"])]),_:1}))}};typeof M=="function"&&M(at);export{at as default};
