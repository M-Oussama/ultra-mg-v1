import{k as c,Z as B,o as V,b as R,w as s,p as e,q as d,D as S,m as a,c as E,F,a as K,x as y,E as x,V as X,v as ee,bd as te,j as ae,y as H,bf as M}from"./main.8fd45797.js";import{_ as le}from"./AppDateTimePicker.0cf194f6.js";import{u as se}from"./useSaleStore.80c0054f.js";import{e as T}from"./errorsMiddleware.62ad9a36.js";import{s as oe}from"./successMiddleware.e3195395.js";import{_ as de}from"./InvoiceSendInvoiceDrawer.c7f1919c.js";import{_ as ie}from"./DialogCloseBtn.204e26b5.js";import{_ as ne}from"./InvoiceProductEdit.a4eaa4ca.js";/* empty css                        */import{V as ue}from"./VDialog.031c6dc0.js";import{V as q,c as g}from"./VCard.1123f389.js";import{V as re}from"./VTable.d87208b6.js";import{V as U,a as ce}from"./VBtn.c93b5ba3.js";import{V as w,a as f}from"./VRow.3025d440.js";import{V as me}from"./VTextField.2ac73a6a.js";import{V as N}from"./VDivider.32b554c9.js";import{V as j}from"./VAutocomplete.2ffc3591.js";import{V as $}from"./VSwitch.9b9452c8.js";import{V as pe}from"./VTextarea.92726099.js";import{u as fe}from"./usereturnStore.388bc9b7.js";import{a as _e}from"./VOverlay.8a102fa4.js";import{V as L}from"./VInput.011a97ea.js";import"./VField.b2abde9d.js";import"./index.96d998ca.js";import"./position.e593359d.js";import"./router.62fd2ce6.js";import"./easing.36b781ab.js";import"./VSpacer.9ecb754a.js";import"./VAvatar.579b8c09.js";import"./VImg.3f9a9712.js";import"./VForm.b5dcb977.js";import"./forwardRefs.c003b6b8.js";import"./VChip.0f94ba81.js";import"./VNavigationDrawer.400678f5.js";import"./ssrBoot.6384c20c.js";/* empty css                                                           */import"./scopeId.54218c30.js";import"./dialog-transition.979db23a.js";/* empty css                   */import"./VCounter.3f3650c6.js";import"./VSelect.29a13347.js";import"./VList.82cd140d.js";import"./VMenu.18127d92.js";import"./VCheckboxBtn.5e6b3514.js";import"./VSelectionControl.a0e35569.js";import"./filter.b6f86828.js";import"./lazy.495b6b1b.js";const ve=a("thead",null,[a("tr",null,[a("th",{class:"text-uppercase"}," Product "),a("th",{class:"text-uppercase"}," Date "),a("th",{class:"text-uppercase"}," Quantity "),a("th",{class:"text-uppercase"}," Price ")])],-1),ye={class:"ma-sm-4"},be={class:"d-flex align-center mb-6"},Ve={class:"font-weight-bold text-xl"},xe={class:"mb-0"},ge={class:"mb-0"},he={class:"mb-0"},we={class:"mt-4 ma-sm-4"},Se={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Ce=a("span",{class:"me-3"},"Invoice",-1),Pe={class:"d-flex align-center justify-sm-end mb-3"},ke=a("span",{class:"me-3"},"Date Issued",-1),Ie={class:"align-center mb-6"},Ae=a("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),De={class:"align-center mb-6"},Te=a("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Ee={class:"mt-4 ma-sm-4"},Ne=a("span",{class:"text-sm-caption mb-5"},"Products",-1),Re=a("div",{class:"mt-7 ma-sm-7"},null,-1),Ue={class:"mx-sm-4 my-2"},$e={class:"align-center mb-4"},je={class:"d-flex"},Le=a("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," PAID : ",-1),qe={class:"my-2 mx-sm-4 display-center"},Oe=a("td",null,[a("div",{class:"me-5 text-start"},[a("p",{class:"mb-2 text-sm"}," Total Invoice ")])],-1),Be={class:"font-weight-semibold"},Fe={class:"mb-2 text-sm"},Ke=a("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),He={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(O){const l=O;let C=c(0);c({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),c([]),c([]);const u=c([]),b=c({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"}),r=c(!1),h=se();let n=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const P=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),k=i=>{l.data.client_id=null,h.getClientsPerCity(l.data.client.city_id).then(t=>{l.data.clients=t.data.clients}).catch(t=>{console.log(t)})},I=i=>{D()},A=i=>`${i.product.name}`;function D(){let i=l.data.sale_items.map(t=>t.price*t.quantity);C.value=i.reduce((t,_)=>t+_,0),l.data.total=i.reduce((t,_)=>t+_,0),l.data.total_amount=i.reduce((t,_)=>t+_,0)}const m=()=>{n.value!==void 0&&n.value.product!==void 0&&n.value.product.id!==-1&&(console.log(n.value.product.id),l.data.sale_items.findIndex(t=>t.product.id===n.value.product.id)===-1&&n.value.product.id!==-1&&l.data.sale_items.push({...n.value}),D())};B(n,()=>{});const p=i=>{const t=l.data.sale_items.findIndex(_=>_.product.id===i.product.id);l.data.sale_items.splice(t,1),D()},v=i=>{m(),n.value={...P.value}},Y=()=>{l.data.payment?l.data.regulation=C.value:l.data.regulation=0};B(l.data.payment,()=>{Y()});const Z=i=>{var t=G(i);l.data.client={...t}},G=i=>{for(let t=0;t<l.data.clients.length;t++)if(l.data.clients[t].id==i)return l.data.clients[t];return null},z=i=>{l.data.client.id!==void 0&&l.data.client.id>-1?h.getPriceHistory(i.product_id,l.data.client.id).then(t=>{u.value=t.data.products,r.value=!0,console.log(t)}).catch(t=>{console.log(t)}):T("Error"," You must select a client first")},Q=i=>{const t=l.data.products.find(_=>_.id===i);n.value={...t},v()};return(i,t)=>{const _=ie,J=le;return V(),R(q,null,{default:s(()=>[e(ue,{modelValue:d(r),"onUpdate:modelValue":t[2]||(t[2]=o=>S(r)?r.value=o:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[e(_,{onClick:t[0]||(t[0]=o=>r.value=!d(r))}),e(q,{title:"Price History "},{default:s(()=>[e(re,{class:"text-no-wrap pt-5"},{default:s(()=>[ve,a("tbody",null,[(V(!0),E(F,null,K(d(u),o=>(V(),E("tr",{key:o.id},[a("td",null,y(o.product.name),1),a("td",null,y(o.sale_date),1),a("td",null,y(o.quantity),1),a("td",null,y(o.price)+" DZD ",1)]))),128))])]),_:1}),e(g,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[e(U,{onClick:t[1]||(t[1]=o=>r.value=!1)},{default:s(()=>[x(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"7"},{default:s(()=>[a("div",ye,[a("div",be,[e(d(X),{nodes:d(ee).app.logo,class:"me-3"},null,8,["nodes"]),a("h6",Ve,y(d(b).name),1)]),a("p",xe,y(d(b).address),1),a("p",ge,y(d(b).address2),1),a("p",he,y(d(b).phone1)+" , "+y(d(b).phone2),1)])]),_:1}),e(f,{cols:"12",md:"5"},{default:s(()=>[a("div",we,[a("h6",Se,[Ce,a("span",null,[e(me,{modelValue:l.data.id,"onUpdate:modelValue":t[3]||(t[3]=o=>l.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),a("p",Pe,[ke,a("span",null,[e(J,{modelValue:l.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=o=>l.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"12"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"6"},{default:s(()=>[a("div",Ie,[Ae,e(j,{clearable:"",modelValue:l.data.client.city_id,"onUpdate:modelValue":[t[5]||(t[5]=o=>l.data.client.city_id=o),k],items:l.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),e(f,{cols:"12",md:"6"},{default:s(()=>[a("div",De,[Te,e(j,{clearable:"",modelValue:l.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=o=>l.data.client_id=o),Z],items:l.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"add-products-form"},{default:s(()=>[a("div",Ee,[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"12"},{default:s(()=>[Ne,e(j,{class:"mt-4",clearable:"",modelValue:d(n),"onUpdate:modelValue":[t[7]||(t[7]=o=>S(n)?n.value=o:n=o),Q],items:l.data.products,"item-value":"id","item-title":A,label:"Products"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"2"})]),_:1})]),Re,(V(!0),E(F,null,K(l.data.sale_items,(o,W)=>(V(),E("div",{key:W,class:"ma-sm-4"},[e(ne,{id:o.id,data:o,onRemoveProduct:p,onTotalAmount:I,onPriceHistory:z},null,8,["id","data"])]))),128))]),_:1}),e(N),e(g,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"3"},{default:s(()=>[a("div",Ue,[a("div",$e,[a("div",je,[Le,e($,{modelValue:l.data.paid,"onUpdate:modelValue":t[8]||(t[8]=o=>l.data.paid=o),"true-value":1,"false-value":0},null,8,["modelValue"])])])])]),_:1}),e(f,{cols:"12",md:"5"}),e(f,{cols:"12",md:"4"},{default:s(()=>[a("div",qe,[a("table",null,[a("tr",null,[Oe,a("td",Be,[a("p",Fe,y(d(C).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"mx-sm-4"},{default:s(()=>[Ke,e(pe,{modelValue:l.data.note,"onUpdate:modelValue":t[9]||(t[9]=o=>l.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},Me=a("h6",{class:"text-sm font-weight-medium mb-3"}," Payment Method: ",-1),Ye={class:"mt-5 d-flex align-center justify-space-between"},Ze={class:"d-flex align-center justify-space-between"},Ge={class:"d-flex align-center justify-space-between"},ze={__name:"[id]",setup(O){const l=te(),C=ae(),u=c({id:1,balance:0,total_amount:0,date:null,client_id:1,city:null,cities:[],sale_status:{id:-1,name:""},amount_letter:"",notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},sale_items:[],clients:[],products:[],sale_statues:[],payment:!0,paymentAmount:0,payment_total:0,totalPayment:0,removePaymentRecords:!1}),b=fe(),r=c({isActive:!1}),h=c(null);b.getReturnData(Number(l.params.id)).then(m=>{r.isActive=!1,u.value=m.data.product_return,u.value.sale_date=u.value.date,u.value.clients=m.data.clients,u.value.cities=m.data.cities,u.value.products=m.data.products,u.value.sale_statues=m.data.sale_statues}).catch(m=>{r.isActive=!1,console.log(m)});const n=c(!1);c(!1);const P=c(!0),k=c(!1),I=c(!1),A=c(!1),D=()=>{u.value.client.id===-1||u.value.date===null||u.value.sale_items.length===0?(u.value.client.id===-1&&T("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),u.value.date===null&&T("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),u.value._product_return_items.length===0&&T("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):r.isActive||(r.isActive=!0,b.updateReturn(u.value).then(m=>{r.isActive=!1,A.value=!0,h.value=m.data.id,oe("Product Return updated Successfully"),C.push("/apps/pos/return/preview/"+h.value)}).catch(m=>{r.isActive=!1,console.log(m),T("Error",""),console.log(m)}))};return(m,p)=>(V(),R(w,null,{default:s(()=>[e(_e,{"model-value":d(r).isActive,class:"align-center justify-center"},{default:s(()=>[e(ce,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),e(f,{cols:"12",md:"9"},{default:s(()=>[e(He,{data:d(u),loading:d(r)},null,8,["data","loading"])]),_:1}),e(f,{cols:"12",md:"3"},{default:s(()=>[e(q,{class:"mb-8"},{default:s(()=>[e(g,null,{default:s(()=>[e(U,{block:"","prepend-icon":"tabler-send",class:"mb-2",onClick:p[0]||(p[0]=v=>n.value=!0)},{default:s(()=>[x(" Send Invoice ")]),_:1}),d(A)?(V(),R(U,{key:0,block:"",color:"secondary",variant:"tonal",class:"mb-2",to:{name:"apps-POS-return-preview-id",params:{id:d(h)}}},{default:s(()=>[x(" Preview ")]),_:1},8,["to"])):H("",!0),d(A)?H("",!0):(V(),R(U,{key:1,loading:d(r).isActive,disabled:d(r).isActive,block:"",color:"success",class:"mb-2",onClick:D},{default:s(()=>[x(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),Me,a("div",Ye,[e(L,{for:"payment-terms"},{default:s(()=>[x(" Payment Terms ")]),_:1}),a("div",null,[e($,{id:"payment-terms",modelValue:d(P),"onUpdate:modelValue":p[1]||(p[1]=v=>S(P)?P.value=v:null)},null,8,["modelValue"])])]),a("div",Ze,[e(L,{for:"client-notes"},{default:s(()=>[x(" Client Notes ")]),_:1}),a("div",null,[e($,{id:"client-notes",modelValue:d(k),"onUpdate:modelValue":p[2]||(p[2]=v=>S(k)?k.value=v:null)},null,8,["modelValue"])])]),a("div",Ge,[e(L,{for:"payment-stub"},{default:s(()=>[x(" Payment Stub ")]),_:1}),a("div",null,[e($,{id:"payment-stub",modelValue:d(I),"onUpdate:modelValue":p[3]||(p[3]=v=>S(I)?I.value=v:null)},null,8,["modelValue"])])])]),_:1}),e(de,{isDrawerOpen:d(n),"onUpdate:isDrawerOpen":p[4]||(p[4]=v=>S(n)?n.value=v:null)},null,8,["isDrawerOpen"])]),_:1}))}};typeof M=="function"&&M(ze);export{ze as default};
