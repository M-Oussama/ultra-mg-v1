import{k as c,Z as X,o as y,b as U,w as s,p as a,q as n,D as P,bl as ee,bm as te,E as V,m as l,c as D,F as B,a as O,x as m,V as ae,v as le,y as L,j as se}from"./main.0cc37d68.js";import{_ as oe}from"./AppDateTimePicker.59b23bcb.js";import{_ as de}from"./DialogCloseBtn.7812f98f.js";import{_ as ne}from"./InvoiceProductEdit.8fa1e8a3.js";/* empty css                        */import{u as Y}from"./useSaleStore.9b1bc972.js";import{e as C}from"./errorsMiddleware.dfcaf12b.js";import{V as ie}from"./VDialog.fde3555c.js";import{V as k,a as ce}from"./VBtn.bfc904f9.js";import{V as q,c as x}from"./VCard.82c7427c.js";import{V as ue}from"./VTable.aa11a9d8.js";import{V as h,a as r}from"./VRow.4110b62f.js";import{V as K}from"./VTextField.33e694f1.js";import{V as T}from"./VDivider.0832d40a.js";import{V as R}from"./VAutocomplete.a784c098.js";import{V as N}from"./VSwitch.bbe55445.js";import{V as me}from"./VTextarea.a93472f8.js";import{s as re}from"./successMiddleware.07d7820d.js";import{a as pe}from"./VOverlay.c4465171.js";import{V as j}from"./VInput.9827f2d3.js";import"./VField.6f5675d6.js";import"./index.f155a171.js";import"./position.9a91b720.js";import"./router.9dff56b1.js";import"./easing.36b781ab.js";/* empty css                                                           */import"./scopeId.e2510c09.js";import"./forwardRefs.c003b6b8.js";import"./dialog-transition.857daf6f.js";import"./VAvatar.25b42a9b.js";import"./VImg.cc77002f.js";/* empty css                   */import"./VCounter.9913b8c7.js";import"./VSelect.09ca08bf.js";import"./VList.89ede2d7.js";import"./VMenu.a230f409.js";import"./VCheckboxBtn.366bf6b8.js";import"./VSelectionControl.58ff8b64.js";import"./VChip.4d799d30.js";import"./filter.56b3ac3a.js";import"./lazy.1b428e2f.js";const fe=l("thead",null,[l("tr",null,[l("th",{class:"text-uppercase"}," Product "),l("th",{class:"text-uppercase"}," Date "),l("th",{class:"text-uppercase"}," Quantity "),l("th",{class:"text-uppercase"}," Price ")])],-1),_e={class:"ma-sm-4"},ve={class:"d-flex align-center mb-6"},ye={class:"font-weight-bold text-xl"},be={class:"mb-0"},Ve={class:"mb-0"},ge={class:"mb-0"},xe={class:"mt-4 ma-sm-4"},he={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},we=l("span",{class:"me-3"},"Invoice",-1),Ae={class:"d-flex align-center justify-sm-end mb-3"},Se=l("span",{class:"me-3"},"Date Issued",-1),De={class:"align-center mb-6"},Ce=l("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),Pe={class:"align-center mb-6"},ke=l("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Ie={class:"mt-4 ma-sm-4"},Ee=l("span",{class:"text-sm-caption mb-5"},"Products",-1),Te=l("div",{class:"mt-7 ma-sm-7"},null,-1),Ne={class:"mx-sm-4 my-2"},Ue={class:"align-center mb-4"},Re={class:"d-flex"},je=l("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payments: ",-1),Le={class:"my-2 mx-sm-4 display-center"},qe=l("td",null,[l("div",{class:"me-5 text-start"},[l("p",{class:"mb-2 text-sm"}," Total Invoice "),l("p",{class:"mb-2 text-sm"}," Payment: "),l("p",{class:"mb-2 text-sm"}," Rest: ")])],-1),Fe={class:"font-weight-semibold"},$e={class:"mb-2 text-sm"},Be={class:"mb-2 text-sm"},Oe={class:"mb-2 text-sm"},Ke=l("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),Ye={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(F){const e=F,I=Y(),p=c(!1);let b=c(0);c({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),c([]),c([]);const v=c({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"});let d=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const w=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),A=i=>{_()},E=i=>{console.log(e.data.client.isEmpty),e.data.client.id!==void 0&&e.data.client.id>-1?I.getPriceHistory(i.id,e.data.client.id).then(t=>{S.value=t.data.products,console.log(S.value),p.value=!0,console.log(t)}).catch(t=>{console.log(t)}):C("Error"," You must select a client first")},S=c([]),u=i=>`${i.product.name}`;function _(){let i=e.data.sale_items.map(t=>t.price*t.quantity);b.value=i.reduce((t,f)=>t+f,0),e.data.total=i.reduce((t,f)=>t+f,0),e.data.total_amount=i.reduce((t,f)=>t+f,0),$()}const g=()=>{d.value!==void 0&&d.value.product!==void 0&&d.value.product.id!==-1&&(console.log(d.value.product.id),e.data.sale_items.findIndex(t=>t.product.id===d.value.product.id)===-1&&d.value.product.id!==-1&&e.data.sale_items.push({...d.value}),_())};X(d,()=>{});const Z=i=>{const t=e.data.sale_items.findIndex(f=>f.product.id===i.product.id);console.log("index: "+t),e.data.sale_items.splice(t,1),_()},H=i=>{var t=M(i);console.log(t),e.data.client={...t}},M=i=>{for(let t=0;t<e.data.clients.length;t++)if(e.data.clients[t].id==i)return e.data.clients[t];return null},G=i=>{g(),d.value={...w.value}},$=()=>{e.data.payment?e.data.paymentAmount=b.value:e.data.paymentAmount=0},z=i=>{e.data.client_id=null,I.getClientsPerCity(e.data.city).then(t=>{e.data.clients=t.data.clients}).catch(t=>{console.log(t)})},Q=i=>{const t=e.data.products.find(f=>f.id===i);d.value={...t},G()};return(i,t)=>{const f=de,J=oe;return y(),U(q,null,{default:s(()=>[a(ie,{modelValue:n(p),"onUpdate:modelValue":t[2]||(t[2]=o=>P(p)?p.value=o:null),persistent:"",class:"v-dialog-sm"},{activator:s(({props:o})=>[a(k,ee(te(o)),{default:s(()=>[V(" Open Dialog ")]),_:2},1040)]),default:s(()=>[a(f,{onClick:t[0]||(t[0]=o=>p.value=!n(p))}),a(q,{title:"Price History "},{default:s(()=>[a(ue,{class:"text-no-wrap pt-5"},{default:s(()=>[fe,l("tbody",null,[(y(!0),D(B,null,O(n(S),o=>(y(),D("tr",{key:o.id},[l("td",null,m(o.product.name),1),l("td",null,m(o.sale_date),1),l("td",null,m(o.quantity),1),l("td",null,m(o.price)+" DZD ",1)]))),128))])]),_:1}),a(x,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[a(k,{onClick:t[1]||(t[1]=o=>p.value=!1)},{default:s(()=>[V(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(x,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[a(h,null,{default:s(()=>[a(r,{cols:"12",md:"7"},{default:s(()=>[l("div",_e,[l("div",ve,[a(n(ae),{nodes:n(le).app.logo,class:"me-3"},null,8,["nodes"]),l("h6",ye,m(n(v).name),1)]),l("p",be,m(n(v).address),1),l("p",Ve,m(n(v).address2),1),l("p",ge,m(n(v).phone1)+" , "+m(n(v).phone2),1)])]),_:1}),a(r,{cols:"12",md:"5"},{default:s(()=>[l("div",xe,[l("h6",he,[we,l("span",null,[a(K,{modelValue:e.data.id,"onUpdate:modelValue":t[3]||(t[3]=o=>e.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),l("p",Ae,[Se,l("span",null,[a(J,{modelValue:e.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=o=>e.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),a(T),a(x,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[a(h,null,{default:s(()=>[a(r,{cols:"12",md:"12"},{default:s(()=>[a(h,null,{default:s(()=>[a(r,{cols:"12",md:"6"},{default:s(()=>[l("div",De,[Ce,a(R,{clearable:"",modelValue:e.data.city,"onUpdate:modelValue":[t[5]||(t[5]=o=>e.data.city=o),z],items:e.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),a(r,{cols:"12",md:"6"},{default:s(()=>[l("div",Pe,[ke,a(R,{clearable:"",modelValue:e.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=o=>e.data.client_id=o),H],items:e.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(T),a(x,{class:"add-products-form"},{default:s(()=>[l("div",Ie,[a(h,null,{default:s(()=>[a(r,{cols:"12",md:"12"},{default:s(()=>[Ee,a(R,{class:"mt-4",clearable:"",modelValue:n(d),"onUpdate:modelValue":[t[7]||(t[7]=o=>P(d)?d.value=o:d=o),Q],items:e.data.products,"item-value":"id","item-title":u,label:"Products"},null,8,["modelValue","items"])]),_:1}),a(r,{cols:"12",md:"2"})]),_:1})]),Te,(y(!0),D(B,null,O(e.data.sale_items,(o,W)=>(y(),D("div",{key:W,class:"ma-sm-4"},[a(ne,{id:o.id,data:o,onRemoveProduct:Z,onTotalAmount:A,onPriceHistory:E},null,8,["id","data"])]))),128))]),_:1}),a(T),a(x,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[a(h,null,{default:s(()=>[a(r,{cols:"12",md:"5"},{default:s(()=>[l("div",Ne,[l("div",Ue,[l("div",Re,[je,a(N,{modelValue:e.data.payment,"onUpdate:modelValue":t[8]||(t[8]=o=>e.data.payment=o),"true-value":1,"false-value":0,onChange:$},null,8,["modelValue"])]),e.data.payment?(y(),U(K,{key:0,modelValue:e.data.paymentAmount,"onUpdate:modelValue":t[9]||(t[9]=o=>e.data.paymentAmount=o),type:"number"},null,8,["modelValue"])):L("",!0)])])]),_:1}),a(r,{cols:"12",md:"3"}),a(r,{cols:"12",md:"4"},{default:s(()=>[l("div",Le,[l("table",null,[l("tr",null,[qe,l("td",Fe,[l("p",$e,m(n(b).toFixed(2))+" DZD ",1),l("p",Be,m(e.data.paymentAmount?e.data.paymentAmount:0)+" DZD ",1),l("p",Oe,m(((e.data.paymentAmount?e.data.paymentAmount:0)-n(b)).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),a(T),a(x,{class:"mx-sm-4"},{default:s(()=>[Ke,a(me,{modelValue:e.data.note,"onUpdate:modelValue":t[10]||(t[10]=o=>e.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},Ze={id:"invoice-add"},He={class:"d-flex align-center justify-space-between"},Me={class:"d-flex align-center justify-space-between"},Ge={class:"d-flex align-center justify-space-between"},jt={__name:"index",setup(F){const e=c({id:1,balance:0,total_amount:0,sale_date:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate(),client_id:null,city:null,sale_status:{id:-1,name:""},amount_letter:"",notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},cities:[],sale_items:[],clients:[],products:[],sale_statues:[],payment:!1,paymentAmount:0}),I=se(),p=c(!0),b=c(!1),v=c(!1);c([]);const d=c({isActive:!1}),w=c(null),A=c(!1),E=Y();d.isActive=!0,E.fetchData().then(u=>{console.log(d.isActive),e.value.id=u.data.last_id,e.value.clients=u.data.clients,e.value.cities=u.data.cities,e.value.products=u.data.products,e.value.sale_statues=u.data.sale_statues,d.isActive=!1,console.log(d.isActive)}).catch(u=>{console.log(u),d.isActive=!1});const S=()=>{e.value.client.id===-1||e.value.sale_date===null||e.value.sale_items.length===0?(e.value.client.id===-1&&C("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),e.value.sale_date===null&&C("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),e.value.sale_items.length===0&&C("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):d.isActive||(d.isActive=!0,E.storeSale(e.value).then(u=>{A.value=!0,w.value=u.data.id,re("Sale created Successfully"),d.isActive=!1,I.push("/apps/pos/sale/preview/"+w.value)}).catch(u=>{d.isActive=!1,console.log(u),C("Error",""),console.log(u)}))};return(u,_)=>(y(),D("div",Ze,[a(pe,{"model-value":n(d).isActive,class:"align-center justify-center"},{default:s(()=>[a(ce,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),a(h,null,{default:s(()=>[a(r,{cols:"12",md:"9"},{default:s(()=>[a(Ye,{data:n(e),loading:n(d)},null,8,["data","loading"])]),_:1}),a(r,{cols:"12",md:"3"},{default:s(()=>[a(q,{class:"mb-8"},{default:s(()=>[a(x,null,{default:s(()=>[a(k,{block:"","prepend-icon":"tabler-send",class:"mb-2"},{default:s(()=>[V(" Send Invoice ")]),_:1}),n(A)?(y(),U(k,{key:0,block:"",color:"default",variant:"tonal",class:"mb-2",to:{name:"apps-POS-sale-preview-id",params:{id:n(w)}}},{default:s(()=>[V(" Preview ")]),_:1},8,["to"])):L("",!0),n(A)?L("",!0):(y(),U(k,{key:1,loading:n(d).isActive,disabled:n(d).isActive,block:"",color:"success",onClick:S},{default:s(()=>[V(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),l("div",He,[a(j,{for:"payment-terms"},{default:s(()=>[V(" Payment Terms ")]),_:1}),l("div",null,[a(N,{id:"payment-terms",modelValue:n(p),"onUpdate:modelValue":_[0]||(_[0]=g=>P(p)?p.value=g:null)},null,8,["modelValue"])])]),l("div",Me,[a(j,{for:"client-notes"},{default:s(()=>[V(" Client Notes ")]),_:1}),l("div",null,[a(N,{id:"client-notes",modelValue:n(b),"onUpdate:modelValue":_[1]||(_[1]=g=>P(b)?b.value=g:null)},null,8,["modelValue"])])]),l("div",Ge,[a(j,{for:"payment-stub"},{default:s(()=>[V(" Payment Stub ")]),_:1}),l("div",null,[a(N,{id:"payment-stub",modelValue:n(v),"onUpdate:modelValue":_[2]||(_[2]=g=>P(v)?v.value=g:null)},null,8,["modelValue"])])])]),_:1})]),_:1})]))}};export{jt as default};
