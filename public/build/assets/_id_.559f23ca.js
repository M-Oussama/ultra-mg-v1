import{k as c,Z as B,o as V,b as R,w as s,p as e,q as d,D as S,m as a,c as E,F,a as K,x as y,E as x,V as W,v as X,bd as ee,j as te,y as H}from"./main.2c4303d0.js";import{_ as ae}from"./AppDateTimePicker.4e132920.js";import{u as le}from"./useSaleStore.67e45db5.js";import{e as T}from"./errorsMiddleware.80a04738.js";import{s as se}from"./successMiddleware.51012923.js";import{_ as oe}from"./InvoiceSendInvoiceDrawer.5c241728.js";import{_ as de}from"./DialogCloseBtn.0b4e7386.js";import{_ as ie}from"./InvoiceProductEdit.6373e3ef.js";/* empty css                        */import{V as ne}from"./VDialog.d797a76b.js";import{V as q,c as g}from"./VCard.e288f4fe.js";import{V as ue}from"./VTable.2b2ab8eb.js";import{V as U,a as re}from"./VBtn.df68b498.js";import{V as w,a as f}from"./VRow.6364c436.js";import{V as ce}from"./VTextField.f25191b8.js";import{V as N}from"./VDivider.ed65e8b8.js";import{V as j}from"./VAutocomplete.0d0fd4fd.js";import{V as $}from"./VSwitch.5d4c558d.js";import{V as me}from"./VTextarea.9cae60d6.js";import{u as pe}from"./usereturnStore.af46352b.js";import{a as fe}from"./VOverlay.34847f66.js";import{V as L}from"./VInput.ad1ab67c.js";import"./VField.f22585ee.js";import"./index.c40dd661.js";import"./position.ef7f4972.js";import"./router.bde67682.js";import"./easing.36b781ab.js";import"./VSpacer.60a3d2b9.js";import"./VAvatar.02a84ac4.js";import"./VImg.c4d008e7.js";import"./VForm.6d323ceb.js";import"./forwardRefs.c003b6b8.js";import"./VChip.72f7cdaa.js";import"./VNavigationDrawer.1c8aa7fa.js";import"./ssrBoot.9a55596c.js";/* empty css                                                           */import"./scopeId.8139f85a.js";import"./dialog-transition.9f6a7431.js";/* empty css                   */import"./VCounter.6f3fca7e.js";import"./VSelect.cc9bae98.js";import"./VList.a40c8ca6.js";import"./VMenu.4f4f7b46.js";import"./VCheckboxBtn.56fc1aec.js";import"./VSelectionControl.b778673c.js";import"./filter.1fe2879b.js";import"./lazy.b22ea8e1.js";const _e=a("thead",null,[a("tr",null,[a("th",{class:"text-uppercase"}," Product "),a("th",{class:"text-uppercase"}," Date "),a("th",{class:"text-uppercase"}," Quantity "),a("th",{class:"text-uppercase"}," Price ")])],-1),ve={class:"ma-sm-4"},ye={class:"d-flex align-center mb-6"},be={class:"font-weight-bold text-xl"},Ve={class:"mb-0"},xe={class:"mb-0"},ge={class:"mb-0"},he={class:"mt-4 ma-sm-4"},we={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},Se=a("span",{class:"me-3"},"Invoice",-1),Ce={class:"d-flex align-center justify-sm-end mb-3"},Pe=a("span",{class:"me-3"},"Date Issued",-1),Ie={class:"align-center mb-6"},ke=a("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),Ae={class:"align-center mb-6"},De=a("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Te={class:"mt-4 ma-sm-4"},Ee=a("span",{class:"text-sm-caption mb-5"},"Products",-1),Ne=a("div",{class:"mt-7 ma-sm-7"},null,-1),Re={class:"mx-sm-4 my-2"},Ue={class:"align-center mb-4"},$e={class:"d-flex"},je=a("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," PAID : ",-1),Le={class:"my-2 mx-sm-4 display-center"},qe=a("td",null,[a("div",{class:"me-5 text-start"},[a("p",{class:"mb-2 text-sm"}," Total Invoice ")])],-1),Oe={class:"font-weight-semibold"},Be={class:"mb-2 text-sm"},Fe=a("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),Ke={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(O){const l=O;let C=c(0);c({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),c([]),c([]);const u=c([]),b=c({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"}),r=c(!1),h=le();let n=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const P=c({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),I=i=>{l.data.client_id=null,h.getClientsPerCity(l.data.client.city_id).then(t=>{l.data.clients=t.data.clients}).catch(t=>{console.log(t)})},k=i=>{D()},A=i=>`${i.product.name}`;function D(){let i=l.data.sale_items.map(t=>t.price*t.quantity);C.value=i.reduce((t,_)=>t+_,0),l.data.total=i.reduce((t,_)=>t+_,0),l.data.total_amount=i.reduce((t,_)=>t+_,0)}const m=()=>{n.value!==void 0&&n.value.product!==void 0&&n.value.product.id!==-1&&(console.log(n.value.product.id),l.data.sale_items.findIndex(t=>t.product.id===n.value.product.id)===-1&&n.value.product.id!==-1&&l.data.sale_items.push({...n.value}),D())};B(n,()=>{});const p=i=>{const t=l.data.sale_items.findIndex(_=>_.product.id===i.product.id);l.data.sale_items.splice(t,1),D()},v=i=>{m(),n.value={...P.value}},M=()=>{l.data.payment?l.data.regulation=C.value:l.data.regulation=0};B(l.data.payment,()=>{M()});const Y=i=>{var t=Z(i);l.data.client={...t}},Z=i=>{for(let t=0;t<l.data.clients.length;t++)if(l.data.clients[t].id==i)return l.data.clients[t];return null},G=i=>{l.data.client.id!==void 0&&l.data.client.id>-1?h.getPriceHistory(i.product_id,l.data.client.id).then(t=>{u.value=t.data.products,r.value=!0,console.log(t)}).catch(t=>{console.log(t)}):T("Error"," You must select a client first")},z=i=>{const t=l.data.products.find(_=>_.id===i);n.value={...t},v()};return(i,t)=>{const _=de,Q=ae;return V(),R(q,null,{default:s(()=>[e(ne,{modelValue:d(r),"onUpdate:modelValue":t[2]||(t[2]=o=>S(r)?r.value=o:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[e(_,{onClick:t[0]||(t[0]=o=>r.value=!d(r))}),e(q,{title:"Price History "},{default:s(()=>[e(ue,{class:"text-no-wrap pt-5"},{default:s(()=>[_e,a("tbody",null,[(V(!0),E(F,null,K(d(u),o=>(V(),E("tr",{key:o.id},[a("td",null,y(o.product.name),1),a("td",null,y(o.sale_date),1),a("td",null,y(o.quantity),1),a("td",null,y(o.price)+" DZD ",1)]))),128))])]),_:1}),e(g,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[e(U,{onClick:t[1]||(t[1]=o=>r.value=!1)},{default:s(()=>[x(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"7"},{default:s(()=>[a("div",ve,[a("div",ye,[e(d(W),{nodes:d(X).app.logo,class:"me-3"},null,8,["nodes"]),a("h6",be,y(d(b).name),1)]),a("p",Ve,y(d(b).address),1),a("p",xe,y(d(b).address2),1),a("p",ge,y(d(b).phone1)+" , "+y(d(b).phone2),1)])]),_:1}),e(f,{cols:"12",md:"5"},{default:s(()=>[a("div",he,[a("h6",we,[Se,a("span",null,[e(ce,{modelValue:l.data.id,"onUpdate:modelValue":t[3]||(t[3]=o=>l.data.id=o),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),a("p",Ce,[Pe,a("span",null,[e(Q,{modelValue:l.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=o=>l.data.sale_date=o),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"12"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"6"},{default:s(()=>[a("div",Ie,[ke,e(j,{clearable:"",modelValue:l.data.client.city_id,"onUpdate:modelValue":[t[5]||(t[5]=o=>l.data.client.city_id=o),I],items:l.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),e(f,{cols:"12",md:"6"},{default:s(()=>[a("div",Ae,[De,e(j,{clearable:"",modelValue:l.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=o=>l.data.client_id=o),Y],items:l.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"add-products-form"},{default:s(()=>[a("div",Te,[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"12"},{default:s(()=>[Ee,e(j,{class:"mt-4",clearable:"",modelValue:d(n),"onUpdate:modelValue":[t[7]||(t[7]=o=>S(n)?n.value=o:n=o),z],items:l.data.products,"item-value":"id","item-title":A,label:"Products"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",md:"2"})]),_:1})]),Ne,(V(!0),E(F,null,K(l.data.sale_items,(o,J)=>(V(),E("div",{key:J,class:"ma-sm-4"},[e(ie,{id:o.id,data:o,onRemoveProduct:p,onTotalAmount:k,onPriceHistory:G},null,8,["id","data"])]))),128))]),_:1}),e(N),e(g,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:s(()=>[e(w,null,{default:s(()=>[e(f,{cols:"12",md:"3"},{default:s(()=>[a("div",Re,[a("div",Ue,[a("div",$e,[je,e($,{modelValue:l.data.paid,"onUpdate:modelValue":t[8]||(t[8]=o=>l.data.paid=o),"true-value":1,"false-value":0},null,8,["modelValue"])])])])]),_:1}),e(f,{cols:"12",md:"5"}),e(f,{cols:"12",md:"4"},{default:s(()=>[a("div",Le,[a("table",null,[a("tr",null,[qe,a("td",Oe,[a("p",Be,y(d(C).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),e(N),e(g,{class:"mx-sm-4"},{default:s(()=>[Fe,e(me,{modelValue:l.data.note,"onUpdate:modelValue":t[9]||(t[9]=o=>l.data.note=o),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}},He=a("h6",{class:"text-sm font-weight-medium mb-3"}," Payment Method: ",-1),Me={class:"mt-5 d-flex align-center justify-space-between"},Ye={class:"d-flex align-center justify-space-between"},Ze={class:"d-flex align-center justify-space-between"},Bt={__name:"[id]",setup(O){const l=ee(),C=te(),u=c({id:1,balance:0,total_amount:0,date:null,client_id:1,city:null,cities:[],sale_status:{id:-1,name:""},amount_letter:"",notes:"",client:{id:-1,name:"",surname:"",address:"",email:"",phone:"",NRC:"",NIF:"",NART:"",NIS:""},sale_items:[],clients:[],products:[],sale_statues:[],payment:!0,paymentAmount:0,payment_total:0,totalPayment:0,removePaymentRecords:!1}),b=pe(),r=c({isActive:!1}),h=c(null);b.getReturnData(Number(l.params.id)).then(m=>{r.isActive=!1,u.value=m.data.product_return,u.value.sale_date=u.value.date,u.value.clients=m.data.clients,u.value.cities=m.data.cities,u.value.products=m.data.products,u.value.sale_statues=m.data.sale_statues}).catch(m=>{r.isActive=!1,console.log(m)});const n=c(!1);c(!1);const P=c(!0),I=c(!1),k=c(!1),A=c(!1),D=()=>{u.value.client.id===-1||u.value.date===null||u.value.sale_items.length===0?(u.value.client.id===-1&&T("Client Not Selected","Oops! Looks like you forgot to select a client for this invoice. Kindly pick at least one client to proceed"),u.value.date===null&&T("The date field is empty","Date field remains empty, and no client has been chosen for the invoice."),u.value._product_return_items.length===0&&T("Select a least one product.","Kindly ensure you've selected at least one product before proceeding.")):r.isActive||(r.isActive=!0,b.updateReturn(u.value).then(m=>{r.isActive=!1,A.value=!0,h.value=m.data.id,se("Product Return updated Successfully"),C.push("/apps/pos/return/preview/"+h.value)}).catch(m=>{r.isActive=!1,console.log(m),T("Error",""),console.log(m)}))};return(m,p)=>(V(),R(w,null,{default:s(()=>[e(fe,{"model-value":d(r).isActive,class:"align-center justify-center"},{default:s(()=>[e(re,{color:"primary",indeterminate:"",size:"64"})]),_:1},8,["model-value"]),e(f,{cols:"12",md:"9"},{default:s(()=>[e(Ke,{data:d(u),loading:d(r)},null,8,["data","loading"])]),_:1}),e(f,{cols:"12",md:"3"},{default:s(()=>[e(q,{class:"mb-8"},{default:s(()=>[e(g,null,{default:s(()=>[e(U,{block:"","prepend-icon":"tabler-send",class:"mb-2",onClick:p[0]||(p[0]=v=>n.value=!0)},{default:s(()=>[x(" Send Invoice ")]),_:1}),d(A)?(V(),R(U,{key:0,block:"",color:"secondary",variant:"tonal",class:"mb-2",to:{name:"apps-POS-return-preview-id",params:{id:d(h)}}},{default:s(()=>[x(" Preview ")]),_:1},8,["to"])):H("",!0),d(A)?H("",!0):(V(),R(U,{key:1,loading:d(r).isActive,disabled:d(r).isActive,block:"",color:"success",class:"mb-2",onClick:D},{default:s(()=>[x(" Save ")]),_:1},8,["loading","disabled"]))]),_:1})]),_:1}),He,a("div",Me,[e(L,{for:"payment-terms"},{default:s(()=>[x(" Payment Terms ")]),_:1}),a("div",null,[e($,{id:"payment-terms",modelValue:d(P),"onUpdate:modelValue":p[1]||(p[1]=v=>S(P)?P.value=v:null)},null,8,["modelValue"])])]),a("div",Ye,[e(L,{for:"client-notes"},{default:s(()=>[x(" Client Notes ")]),_:1}),a("div",null,[e($,{id:"client-notes",modelValue:d(I),"onUpdate:modelValue":p[2]||(p[2]=v=>S(I)?I.value=v:null)},null,8,["modelValue"])])]),a("div",Ze,[e(L,{for:"payment-stub"},{default:s(()=>[x(" Payment Stub ")]),_:1}),a("div",null,[e($,{id:"payment-stub",modelValue:d(k),"onUpdate:modelValue":p[3]||(p[3]=v=>S(k)?k.value=v:null)},null,8,["modelValue"])])])]),_:1}),e(oe,{isDrawerOpen:d(n),"onUpdate:isDrawerOpen":p[4]||(p[4]=v=>S(n)?n.value=v:null)},null,8,["isDrawerOpen"])]),_:1}))}};export{Bt as default};
