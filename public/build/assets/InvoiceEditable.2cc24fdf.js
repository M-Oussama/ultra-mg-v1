import{_ as M}from"./AppDateTimePicker.3a302d25.js";import{_ as z}from"./DialogCloseBtn.dfbf179c.js";import{_ as Q}from"./InvoiceProductEdit.76fcbc78.js";import{k as r,Z as J,o as _,b as E,w as o,p as l,q as i,D as I,bo as W,bp as X,E as P,m as e,c as V,F as A,a as S,x as c,V as tt,v as et,y as at}from"./main.d0838da3.js";/* empty css                        */import{u as lt}from"./useSaleStore.5f8d3d14.js";import{e as st}from"./errorsMiddleware.0785696e.js";import{V as ot}from"./VDialog.225916a1.js";import{V as T}from"./VBtn.d8db924d.js";import{V as k,c as f}from"./VCard.9b1f82a8.js";import{V as dt}from"./VTable.57beb093.js";import{V as y,a as u}from"./VRow.10fd63fa.js";import{V as U}from"./VTextField.21e071fb.js";import{V as b}from"./VDivider.43577cc2.js";import{V as w}from"./VAutocomplete.04d7cc02.js";import{V as nt}from"./VSwitch.c4034b57.js";import{V as it}from"./VTextarea.f1dd0859.js";const ct=e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase"}," Product "),e("th",{class:"text-uppercase"}," Date "),e("th",{class:"text-uppercase"}," Quantity "),e("th",{class:"text-uppercase"}," Price ")])],-1),mt={class:"ma-sm-4"},ut={class:"d-flex align-center mb-6"},rt={class:"font-weight-bold text-xl"},pt={class:"mb-0"},_t={class:"mb-0"},ft={class:"mb-0"},xt={class:"mt-4 ma-sm-4"},yt={class:"d-flex align-center font-weight-medium justify-sm-end text-xl mb-3"},vt=e("span",{class:"me-3"},"Invoice",-1),Vt={class:"d-flex align-center justify-sm-end mb-3"},bt=e("span",{class:"me-3"},"Date Issued",-1),ht={class:"align-center mb-6"},gt=e("h6",{class:"text-sm font-weight-medium mb-3"}," City: ",-1),wt={class:"align-center mb-6"},Ct=e("h6",{class:"text-sm font-weight-medium mb-3"}," Invoice To: ",-1),Dt={class:"mt-4 ma-sm-4"},Et=e("span",{class:"text-sm-caption mb-5"},"Products",-1),It=e("div",{class:"mt-7 ma-sm-7"},null,-1),Pt={class:"mx-sm-4 my-2"},At={class:"align-center mb-4"},St={class:"d-flex"},Tt=e("span",{class:"text-sm font-weight-semibold me-2 mb-2 pt-2"}," Payments: ",-1),kt={class:"my-2 mx-sm-4 display-center"},Ut=e("td",null,[e("div",{class:"me-5 text-start"},[e("p",{class:"mb-2 text-sm"}," Total Invoice "),e("p",{class:"mb-2 text-sm"}," Payment: "),e("p",{class:"mb-2 text-sm"}," Rest: ")])],-1),Nt={class:"font-weight-semibold"},Rt={class:"mb-2 text-sm"},qt={class:"mb-2 text-sm"},Lt={class:"mb-2 text-sm"},Bt=e("p",{class:"font-weight-semibold mb-2"}," Note: ",-1),ae={__name:"InvoiceEditable",props:{data:{type:null,required:!0},loading:{type:null,required:!0}},setup(N){const a=N,C=lt(),p=r(!1);let v=r(0);r({id:-1,name:"",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}),r([]),r([]);const x=r({name:"EURL SETIFIS DETERGENTS",address:"LOT N, 6 GROUPE 51, ZONE INDUSTRIELLE, 34 SECTION, Ksar El Abtal 19220",address2:"KASR EL ABTAL 19220, SETIF, ALGERIE",phone1:"+213 0668 15 41 45",phone2:"+213 0668 15 41 45"});let n=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}});const R=r({quantity:0,price:0,total:0,product:{id:-1,name:"Select a product",brand:"",description:"",product_code:"",SKU:"",price:0,stockable:!1,tax_rate:0,product_stock:{quantity:0}}}),q=d=>{g()},L=d=>{console.log(a.data.client.isEmpty),a.data.client.id!==void 0&&a.data.client.id>-1?C.getPriceHistory(d.id,a.data.client.id).then(t=>{h.value=t.data.products,console.log(h.value),p.value=!0,console.log(t)}).catch(t=>{console.log(t)}):st("Error"," You must select a client first")},h=r([]),B=d=>`${d.product.name}`;function g(){let d=a.data.sale_items.map(t=>t.price*t.quantity);v.value=d.reduce((t,m)=>t+m,0),a.data.total=d.reduce((t,m)=>t+m,0),a.data.total_amount=d.reduce((t,m)=>t+m,0),D()}const F=()=>{n.value!==void 0&&n.value.product!==void 0&&n.value.product.id!==-1&&(console.log(n.value.product.id),a.data.sale_items.findIndex(t=>t.product.id===n.value.product.id)===-1&&n.value.product.id!==-1&&a.data.sale_items.push({...n.value}),g())};J(n,()=>{});const j=d=>{const t=a.data.sale_items.findIndex(m=>m.product.id===d.product.id);console.log("index: "+t),a.data.sale_items.splice(t,1),g()},Z=d=>{var t=H(d);console.log(t),a.data.client={...t}},H=d=>{for(let t=0;t<a.data.clients.length;t++)if(a.data.clients[t].id==d)return a.data.clients[t];return null},K=d=>{F(),n.value={...R.value}},D=()=>{a.data.payment?a.data.paymentAmount=v.value:a.data.paymentAmount=0},O=d=>{a.data.client_id=null,C.getClientsPerCity(a.data.city).then(t=>{a.data.clients=t.data.clients}).catch(t=>{console.log(t)})},Y=d=>{const t=a.data.products.find(m=>m.id===d);n.value={...t},K()};return(d,t)=>{const m=z,$=M;return _(),E(k,null,{default:o(()=>[l(ot,{modelValue:i(p),"onUpdate:modelValue":t[2]||(t[2]=s=>I(p)?p.value=s:null),persistent:"",class:"v-dialog-sm"},{activator:o(({props:s})=>[l(T,W(X(s)),{default:o(()=>[P(" Open Dialog ")]),_:2},1040)]),default:o(()=>[l(m,{onClick:t[0]||(t[0]=s=>p.value=!i(p))}),l(k,{title:"Price History "},{default:o(()=>[l(dt,{class:"text-no-wrap pt-5"},{default:o(()=>[ct,e("tbody",null,[(_(!0),V(A,null,S(i(h),s=>(_(),V("tr",{key:s.id},[e("td",null,c(s.product.name),1),e("td",null,c(s.sale_date),1),e("td",null,c(s.quantity),1),e("td",null,c(s.price)+" DZD ",1)]))),128))])]),_:1}),l(f,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[l(T,{onClick:t[1]||(t[1]=s=>p.value=!1)},{default:o(()=>[P(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(f,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:o(()=>[l(y,null,{default:o(()=>[l(u,{cols:"12",md:"7"},{default:o(()=>[e("div",mt,[e("div",ut,[l(i(tt),{nodes:i(et).app.logo,class:"me-3"},null,8,["nodes"]),e("h6",rt,c(i(x).name),1)]),e("p",pt,c(i(x).address),1),e("p",_t,c(i(x).address2),1),e("p",ft,c(i(x).phone1)+" , "+c(i(x).phone2),1)])]),_:1}),l(u,{cols:"12",md:"5"},{default:o(()=>[e("div",xt,[e("h6",yt,[vt,e("span",null,[l(U,{modelValue:a.data.id,"onUpdate:modelValue":t[3]||(t[3]=s=>a.data.id=s),disabled:"",prefix:"#",density:"compact",style:{width:"8.9rem"}},null,8,["modelValue"])])]),e("p",Vt,[bt,e("span",null,[l($,{modelValue:a.data.sale_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.data.sale_date=s),density:"compact",placeholder:"YYYY-MM-DD",style:{width:"8.9rem"},config:{position:"auto right"}},null,8,["modelValue"])])])])]),_:1})]),_:1})]),_:1}),l(b),l(f,{class:"d-flex flex-wrap justify-space-between flex-column flex-sm-row"},{default:o(()=>[l(y,null,{default:o(()=>[l(u,{cols:"12",md:"12"},{default:o(()=>[l(y,null,{default:o(()=>[l(u,{cols:"12",md:"6"},{default:o(()=>[e("div",ht,[gt,l(w,{clearable:"",modelValue:a.data.city,"onUpdate:modelValue":[t[5]||(t[5]=s=>a.data.city=s),O],items:a.data.cities,"item-value":"id","item-title":"name",label:"City"},null,8,["modelValue","items"])])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[e("div",wt,[Ct,l(w,{clearable:"",modelValue:a.data.client_id,"onUpdate:modelValue":[t[6]||(t[6]=s=>a.data.client_id=s),Z],items:a.data.clients,"item-value":"id","item-title":"full_name",label:"Client"},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(b),l(f,{class:"add-products-form"},{default:o(()=>[e("div",Dt,[l(y,null,{default:o(()=>[l(u,{cols:"12",md:"12"},{default:o(()=>[Et,l(w,{class:"mt-4",clearable:"",modelValue:i(n),"onUpdate:modelValue":[t[7]||(t[7]=s=>I(n)?n.value=s:n=s),Y],items:a.data.products,"item-value":"id","item-title":B,label:"Products"},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",md:"2"})]),_:1})]),It,(_(!0),V(A,null,S(a.data.sale_items,(s,G)=>(_(),V("div",{key:G,class:"ma-sm-4"},[l(Q,{id:s.id,data:s,onRemoveProduct:j,onTotalAmount:q,onPriceHistory:L},null,8,["id","data"])]))),128))]),_:1}),l(b),l(f,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:o(()=>[l(y,null,{default:o(()=>[l(u,{cols:"12",md:"5"},{default:o(()=>[e("div",Pt,[e("div",At,[e("div",St,[Tt,l(nt,{modelValue:a.data.payment,"onUpdate:modelValue":t[8]||(t[8]=s=>a.data.payment=s),"true-value":1,"false-value":0,onChange:D},null,8,["modelValue"])]),a.data.payment?(_(),E(U,{key:0,modelValue:a.data.paymentAmount,"onUpdate:modelValue":t[9]||(t[9]=s=>a.data.paymentAmount=s),type:"number"},null,8,["modelValue"])):at("",!0)])])]),_:1}),l(u,{cols:"12",md:"3"}),l(u,{cols:"12",md:"4"},{default:o(()=>[e("div",kt,[e("table",null,[e("tr",null,[Ut,e("td",Nt,[e("p",Rt,c(i(v).toFixed(2))+" DZD ",1),e("p",qt,c(a.data.paymentAmount?a.data.paymentAmount:0)+" DZD ",1),e("p",Lt,c(((a.data.paymentAmount?a.data.paymentAmount:0)-i(v)).toFixed(2))+" DZD ",1)])])])])]),_:1})]),_:1})]),_:1}),l(b),l(f,{class:"mx-sm-4"},{default:o(()=>[Bt,l(it,{modelValue:a.data.note,"onUpdate:modelValue":t[10]||(t[10]=s=>a.data.note=s),rows:2},null,8,["modelValue"])]),_:1})]),_:1})}}};export{ae as _};
